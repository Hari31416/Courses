
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This is a collection of all the notebooks from various courses I have taken.">
      
      
        <meta name="author" content="Harikesh Kushwaha">
      
      
        <link rel="canonical" href="https://hari31416.github.io/Courses/TF_Specialization/C3/W3/Assignment/C3W3_Assignment/">
      
      
        <link rel="prev" href="../../../W2/Labs/Object_Detection_Inference_on_TF_2_and_TF_Hub/">
      
      
        <link rel="next" href="../../Labs/C3_W3_Lab_1_VGG16_FCN8_CamVid/">
      
      <link rel="icon" href="../../../../../assets/ml.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>C3W3 Assignment - Courses</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../../../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../../../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#week-3-assignment-image-segmentation-of-handwritten-digits" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Courses" class="md-header__button md-logo" aria-label="Courses" data-md-component="logo">
      
  <img src="../../../../../assets/ml.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Courses
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              C3W3 Assignment
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Hari31416/Courses" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Courses
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Courses" class="md-nav__button md-logo" aria-label="Courses" data-md-component="logo">
      
  <img src="../../../../../assets/ml.png" alt="logo">

    </a>
    Courses
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Hari31416/Courses" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Courses
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Deep Learning Specialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Deep Learning Specialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          C1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          C1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C1/Assignments/Building_your_Deep_Neural_Network_Step_by_Step/Building_your_Deep_Neural_Network_Step_by_Step/" class="md-nav__link">
        Building your Deep Neural Network Step by Step
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C1/Assignments/Deep_Neural_Network_-_Application/Deep_Neural_Network_-_Application/" class="md-nav__link">
        Deep Neural Network   Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C1/Assignments/Logistic_Regression_with_a_Neural_Network_mindset/Logistic_Regression_with_a_Neural_Network_mindset/" class="md-nav__link">
        Logistic Regression with a Neural Network mindset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C1/Assignments/Planar_data_classification_with_one_hidden_layer/Planar_data_classification_with_one_hidden_layer/" class="md-nav__link">
        Planar data classification with one hidden layer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          C2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          C2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Gradient_Checking/Gradient_Checking/" class="md-nav__link">
        Gradient Checking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Initialization/Initialization/" class="md-nav__link">
        Initialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Optimization_Methods/Optimization_methods/" class="md-nav__link">
        Optimization methods
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Regularization/Regularization/" class="md-nav__link">
        Regularization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Tensorflow_introduction/Tensorflow_introduction/" class="md-nav__link">
        Tensorflow introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          C4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          C4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Car_detection_with_YOLO/Autonomous_driving_application_Car_detection/" class="md-nav__link">
        Autonomous driving application Car detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Convolution_model_Application/Convolution_model_Application/" class="md-nav__link">
        Convolution model Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Image_segmentation_Unet/Image_segmentation_Unet_v2/" class="md-nav__link">
        Image segmentation Unet v2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Residual_Networks/Residual_Networks/" class="md-nav__link">
        Residual Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Transfer_learning_with_MobileNet/Transfer_learning_with_MobileNet_v1/" class="md-nav__link">
        Transfer learning with MobileNet v1
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          C5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          C5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Building_a_Recurrent_Neural_Network_Step_by_Step/Building_a_Recurrent_Neural_Network_Step_by_Step/" class="md-nav__link">
        Building a Recurrent Neural Network Step by Step
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Dinosaurus_Island_Character_level_language_model/Dinosaurus_Island_Character_level_language_model/" class="md-nav__link">
        Dinosaurus Island Character level language model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Emojify/Emoji_v3a/" class="md-nav__link">
        Emoji v3a
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Improvise_a_Jazz_Solo_with_an_LSTM_Network/Improvise_a_Jazz_Solo_with_an_LSTM_Network_v4/" class="md-nav__link">
        Improvise a Jazz Solo with an LSTM Network v4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Neural_machine_translation_with_attention/Neural_machine_translation_with_attention_v4a/" class="md-nav__link">
        Neural machine translation with attention v4a
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Operations_on_Word_Vectors_Debiasing/Operations_on_word_vectors_v2a/" class="md-nav__link">
        Operations on word vectors v2a
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Machine Learning Specialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Machine Learning Specialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          C1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          C1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/C1_W1_Lab03_Model_Representation_Soln/" class="md-nav__link">
        C1 W1 Lab03 Model Representation Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/C1_W1_Lab04_Cost_function_Soln/" class="md-nav__link">
        C1 W1 Lab04 Cost function Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/C1_W1_Lab05_Gradient_Descent_Soln/" class="md-nav__link">
        C1 W1 Lab05 Gradient Descent Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab01_Python_Jupyter_Soln/" class="md-nav__link">
        C1 W1 Lab01 Python Jupyter Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab02_Course_Preview_Soln/" class="md-nav__link">
        C1 W1 Lab02 Course Preview Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab03_Model_Representation_Soln/" class="md-nav__link">
        C1 W1 Lab03 Model Representation Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab04_Cost_function_Soln/" class="md-nav__link">
        C1 W1 Lab04 Cost function Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab05_Gradient_Descent_Soln/" class="md-nav__link">
        C1 W1 Lab05 Gradient Descent Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Notes/Linear_Regression/" class="md-nav__link">
        Linear Regression
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Notes/Overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab01_Python_Numpy_Vectorization_Soln/" class="md-nav__link">
        C1 W2 Lab01 Python Numpy Vectorization Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab02_Multiple_Variable_Soln/" class="md-nav__link">
        C1 W2 Lab02 Multiple Variable Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab03_Feature_Scaling_and_Learning_Rate_Soln/" class="md-nav__link">
        C1 W2 Lab03 Feature Scaling and Learning Rate Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab04_FeatEng_PolyReg_Soln/" class="md-nav__link">
        C1 W2 Lab04 FeatEng PolyReg Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab05_Sklearn_GD_Soln/" class="md-nav__link">
        C1 W2 Lab05 Sklearn GD Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab06_Sklearn_Normal_Soln/" class="md-nav__link">
        C1 W2 Lab06 Sklearn Normal Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/Linear_Regression/C1_W2_Linear_Regression/" class="md-nav__link">
        C1 W2 Linear Regression
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab01_Classification_Soln/" class="md-nav__link">
        C1 W3 Lab01 Classification Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab02_Sigmoid_function_Soln/" class="md-nav__link">
        C1 W3 Lab02 Sigmoid function Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab03_Decision_Boundary_Soln/" class="md-nav__link">
        C1 W3 Lab03 Decision Boundary Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab04_LogisticLoss_Soln/" class="md-nav__link">
        C1 W3 Lab04 LogisticLoss Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab05_Cost_Function_Soln/" class="md-nav__link">
        C1 W3 Lab05 Cost Function Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab07_Scikit_Learn_Soln/" class="md-nav__link">
        C1 W3 Lab07 Scikit Learn Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab08_Overfitting_Soln/" class="md-nav__link">
        C1 W3 Lab08 Overfitting Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab09_Regularization_Soln/" class="md-nav__link">
        C1 W3 Lab09 Regularization Soln
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          C2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          C2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W1/Assignment/C2_W1_Assignment/" class="md-nav__link">
        C2 W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W1/Lab/C2_W1_Lab01_Neurons_and_Layers/" class="md-nav__link">
        C2 W1 Lab01 Neurons and Layers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W1/Lab/C2_W1_Lab02_CoffeeRoasting_TF/" class="md-nav__link">
        C2 W1 Lab02 CoffeeRoasting TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W1/Lab/C2_W1_Lab03_CoffeeRoasting_Numpy/" class="md-nav__link">
        C2 W1 Lab03 CoffeeRoasting Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W2/Assignment/C2_W2_Assignment/" class="md-nav__link">
        C2 W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W2/Lab/C2_W2_Multiclass_TF/" class="md-nav__link">
        C2 W2 Multiclass TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W2/Lab/C2_W2_Relu/" class="md-nav__link">
        C2 W2 Relu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W2/Lab/C2_W2_SoftMax/" class="md-nav__link">
        C2 W2 SoftMax
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W3/Assignment/C2_W3_Assignment/" class="md-nav__link">
        C2 W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W4/Assignment/C2_W4_Decision_Tree_with_Markdown/" class="md-nav__link">
        C2 W4 Decision Tree with Markdown
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          C3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          C3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W1/Assignment/A1/C3_W1_KMeans_Assignment/" class="md-nav__link">
        C3 W1 KMeans Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W1/Assignment/A2/C3_W1_Anomaly_Detection/" class="md-nav__link">
        C3 W1 Anomaly Detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W2/Assignment/A1/C3_W2_Collaborative_RecSys_Assignment/" class="md-nav__link">
        C3 W2 Collaborative RecSys Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W2/Assignment/A2/C3_W2_RecSysNN_Assignment/" class="md-nav__link">
        C3 W2 RecSysNN Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W3/Assignment/C3_W3_A1_Assignment/" class="md-nav__link">
        C3 W3 A1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W3/Lab/State-action%20value%20function%20example/" class="md-nav__link">
        State action value function example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          TensorFlow Advanced Techniques Specialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Advanced Techniques Specialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          C1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          C1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W1/Labs/C1_W1_Lab_1_functional-practice/" class="md-nav__link">
        C1 W1 Lab 1 functional practice
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W1/Labs/C1_W1_Lab_2_multi-output/" class="md-nav__link">
        C1 W1 Lab 2 multi output
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W1/Labs/C1_W1_Lab_3_siamese-network/" class="md-nav__link">
        C1 W1 Lab 3 siamese network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W1/Multiple_Output_Models_using_the_Keras_Functional_API/C1W1_Assignment/" class="md-nav__link">
        C1W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W2/Creating_a_Custom_Loss_Function/C1W2_Assignment/" class="md-nav__link">
        C1W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W2/Labs/C1_W2_Lab_1_huber-loss/" class="md-nav__link">
        C1 W2 Lab 1 huber loss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W2/Labs/C1_W2_Lab_2_huber-object-loss/" class="md-nav__link">
        C1 W2 Lab 2 huber object loss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W3/Implement_a_Quadratic_Layer/C1W3_Assignment/" class="md-nav__link">
        C1W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W3/Labs/C1_W3_Lab_1_lambda-layer/" class="md-nav__link">
        C1 W3 Lab 1 lambda layer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W3/Labs/C1_W3_Lab_2_custom-dense-layer/" class="md-nav__link">
        C1 W3 Lab 2 custom dense layer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W3/Labs/C1_W3_Lab_3_custom-layer-activation/" class="md-nav__link">
        C1 W3 Lab 3 custom layer activation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W4/Create_a_VGG_network/C1W4_Assignment/" class="md-nav__link">
        C1W4 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W4/Labs/C1_W4_Lab_1_basic-model/" class="md-nav__link">
        C1 W4 Lab 1 basic model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W4/Labs/C1_W4_Lab_2_resnet-example/" class="md-nav__link">
        C1 W4 Lab 2 resnet example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          C2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          C2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W1/Assignment/C2W1_Assignment/" class="md-nav__link">
        C2W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W1/Labs/C2_W1_Lab_1_basic-tensors/" class="md-nav__link">
        C2 W1 Lab 1 basic tensors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W1/Labs/C2_W1_Lab_2_gradient-tape-basics/" class="md-nav__link">
        C2 W1 Lab 2 gradient tape basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W2/Assignment/C2W2_Assignment/" class="md-nav__link">
        C2W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W2/Labs/C2_W2_Lab_1_training-basics/" class="md-nav__link">
        C2 W2 Lab 1 training basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W2/Labs/C2_W2_Lab_2_training-categorical/" class="md-nav__link">
        C2 W2 Lab 2 training categorical
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W3/Assignment/C2W3_Assignment/" class="md-nav__link">
        C2W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W3/Labs/C2_W3_Lab_1_autograph-basics/" class="md-nav__link">
        C2 W3 Lab 1 autograph basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W3/Labs/C2_W3_Lab_2-graphs-for-complex-code/" class="md-nav__link">
        C2 W3 Lab 2 graphs for complex code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Assignment/C2W4_Assignment/" class="md-nav__link">
        C2W4 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Labs/C2_W4_Lab_1_basic-mirrored-strategy/" class="md-nav__link">
        C2 W4 Lab 1 basic mirrored strategy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Labs/C2_W4_Lab_2_multi-GPU-mirrored-strategy/" class="md-nav__link">
        C2 W4 Lab 2 multi GPU mirrored strategy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Labs/C2_W4_Lab_3_using-TPU-strategy/" class="md-nav__link">
        C2 W4 Lab 3 using TPU strategy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Labs/C2_W4_Lab_4_one-device-strategy/" class="md-nav__link">
        C2 W4 Lab 4 one device strategy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          C3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          C3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W1/Assignment/C3W1_Assignment/" class="md-nav__link">
        C3W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W1/Labs/C3_W1_Lab_2_Transfer_Learning_CIFAR_10/" class="md-nav__link">
        C3 W1 Lab 2 Transfer Learning CIFAR 10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W1/Labs/C3_W1_Lab_3_Object_Localization/" class="md-nav__link">
        C3 W1 Lab 3 Object Localization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W2/Assignment/C3W2_Assignment/" class="md-nav__link">
        C3W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W2/Labs/C3_W2_Lab_1_Simple_Object_Detection/" class="md-nav__link">
        C3 W2 Lab 1 Simple Object Detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W2/Labs/Object_Detection_Inference_on_TF_2_and_TF_Hub/" class="md-nav__link">
        Object Detection Inference on TF 2 and TF Hub
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          C3W3 Assignment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        C3W3 Assignment
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    Exercises
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    Imports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-the-dataset" class="md-nav__link">
    Download the dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-and-preprocess-the-dataset" class="md-nav__link">
    Load and Preprocess the Dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lets-take-a-look-at-the-dataset" class="md-nav__link">
    Let's Take a Look at the Dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-the-model" class="md-nav__link">
    Define the Model
  </a>
  
    <nav class="md-nav" aria-label="Define the Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-the-basic-convolution-block" class="md-nav__link">
    Define the Basic Convolution Block
  </a>
  
    <nav class="md-nav" aria-label="Define the Basic Convolution Block">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1" class="md-nav__link">
    Exercise 1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-the-downsampling-path" class="md-nav__link">
    Define the Downsampling Path
  </a>
  
    <nav class="md-nav" aria-label="Define the Downsampling Path">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-2" class="md-nav__link">
    Exercise 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-the-fcn-8-decoder" class="md-nav__link">
    Define the FCN-8 decoder
  </a>
  
    <nav class="md-nav" aria-label="Define the FCN-8 decoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-3" class="md-nav__link">
    Exercise 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#define-the-complete-model" class="md-nav__link">
    Define the Complete Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compile-the-model" class="md-nav__link">
    Compile the Model
  </a>
  
    <nav class="md-nav" aria-label="Compile the Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-4" class="md-nav__link">
    Exercise 4
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-training" class="md-nav__link">
    Model Training
  </a>
  
    <nav class="md-nav" aria-label="Model Training">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-5" class="md-nav__link">
    Exercise 5
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-evaluation" class="md-nav__link">
    Model Evaluation
  </a>
  
    <nav class="md-nav" aria-label="Model Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-predictions" class="md-nav__link">
    Make Predictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    Metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualize-predictions" class="md-nav__link">
    Visualize Predictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute-iou-score-and-dice-score-of-your-model" class="md-nav__link">
    Compute IOU Score and Dice Score of your model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-the-model" class="md-nav__link">
    Save the Model
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/C3_W3_Lab_1_VGG16_FCN8_CamVid/" class="md-nav__link">
        C3 W3 Lab 1 VGG16 FCN8 CamVid
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/C3_W3_Lab_2_OxfordPets_UNet/" class="md-nav__link">
        C3 W3 Lab 2 OxfordPets UNet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/C3_W3_Lab_3_Mask_RCNN_ImageSegmentation/" class="md-nav__link">
        C3 W3 Lab 3 Mask RCNN ImageSegmentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W4/Assignment/C3_W4_Assignment/" class="md-nav__link">
        C3 W4 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W4/Labs/C3_W4_Lab_1_FashionMNIST_CAM/" class="md-nav__link">
        C3 W4 Lab 1 FashionMNIST CAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W4/Labs/C3_W4_Lab_2_CatsDogs_CAM/" class="md-nav__link">
        C3 W4 Lab 2 CatsDogs CAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W4/Labs/C3_W4_Lab_3_Saliency/" class="md-nav__link">
        C3 W4 Lab 3 Saliency
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          C4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          C4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W1/Assignment/C4W1_Assignment/" class="md-nav__link">
        C4W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W1/Labs/C4_W1_Lab_1_Neural_Style_Transfer/" class="md-nav__link">
        C4 W1 Lab 1 Neural Style Transfer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W1/Labs/C4_W1_Lab_2_Fast_NST/" class="md-nav__link">
        C4 W1 Lab 2 Fast NST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Assignment/C4W2_Assignment/" class="md-nav__link">
        C4W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_1_FirstAutoEncoder/" class="md-nav__link">
        C4 W2 Lab 1 FirstAutoEncoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_2_MNIST_Autoencoder/" class="md-nav__link">
        C4 W2 Lab 2 MNIST Autoencoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_3_MNIST_DeepAutoencoder/" class="md-nav__link">
        C4 W2 Lab 3 MNIST DeepAutoencoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_4_FashionMNIST_CNNAutoEncoder/" class="md-nav__link">
        C4 W2 Lab 4 FashionMNIST CNNAutoEncoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_5_FashionMNIST_NoisyCNNAutoEncoder/" class="md-nav__link">
        C4 W2 Lab 5 FashionMNIST NoisyCNNAutoEncoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W3/Assignment/C4W3_Assignment/" class="md-nav__link">
        C4W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W3/Labs/C4_W3_Lab_1_VAE_MNIST/" class="md-nav__link">
        C4 W3 Lab 1 VAE MNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W4/Assignment/C4W4_Assignment/" class="md-nav__link">
        C4W4 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W4/Labs/C4_W4_Lab_1_First_GAN/" class="md-nav__link">
        C4 W4 Lab 1 First GAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W4/Labs/C4_W4_Lab_2_First_DCGAN/" class="md-nav__link">
        C4 W4 Lab 2 First DCGAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W4/Labs/C4_W4_Lab_3_CelebA_GAN_Experiments/" class="md-nav__link">
        C4 W4 Lab 3 CelebA GAN Experiments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Generative Adversarial Networks Specialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Generative Adversarial Networks Specialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
      
      
      
        <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
          C1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          C1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W1/Assignments/C1W1_Your_First_GAN/" class="md-nav__link">
        C1W1 Your First GAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W1/Labs/Intro_to_PyTorch/" class="md-nav__link">
        Intro to PyTorch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W2/Assignments/C1_W2_Assignment/" class="md-nav__link">
        C1 W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W2/Labs/C1W2_Video_Generation_%28Optional%29/" class="md-nav__link">
        C1W2 Video Generation (Optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W3/Assignments/C1W3_WGAN_GP/" class="md-nav__link">
        C1W3 WGAN GP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W3/Labs/SNGAN/" class="md-nav__link">
        SNGAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W4/Assignments/C1W4A_Build_a_Conditional_GAN/" class="md-nav__link">
        C1W4A Build a Conditional GAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W4/Assignments/C1W4B_Controllable_Generation/" class="md-nav__link">
        C1W4B Controllable Generation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          C2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          C2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W1/Assignments/C2W1_Assignment/" class="md-nav__link">
        C2W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W1/Labs/PPL/" class="md-nav__link">
        PPL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W2/Assignments/C2W2_Assignment/" class="md-nav__link">
        C2W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W2/Labs/C2W2_VAE/" class="md-nav__link">
        C2W2 VAE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W3/Assignments/C2W3_Assignment/" class="md-nav__link">
        C2W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W3/Labs/BigGAN/" class="md-nav__link">
        BigGAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W3/Labs/StyleGAN2/" class="md-nav__link">
        StyleGAN2
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
          C3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          C3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W1/Assignments/C3W1_Assignment/" class="md-nav__link">
        C3W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W1/Labs/C3W1_Generative_Teaching_Networks_%28Optional%29/" class="md-nav__link">
        C3W1 Generative Teaching Networks (Optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W2/Assignments/C3W2A_Assignment/" class="md-nav__link">
        C3W2A Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W2/Assignments/C3W2B_Assignment/" class="md-nav__link">
        C3W2B Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W2/Labs/C3W2_GauGAN_%28Optional%29/" class="md-nav__link">
        C3W2 GauGAN (Optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W2/Labs/C3W2_Pix2PixHD_%28Optional%29/" class="md-nav__link">
        C3W2 Pix2PixHD (Optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W3/Assignments/C3W3_Assignment/" class="md-nav__link">
        C3W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W3/Labs/C3W3_MUNIT_%28Optional%29/" class="md-nav__link">
        C3W3 MUNIT (Optional)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Deep Learning AI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Deep Learning AI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          Diffusion
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Diffusion
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Diffusion/Lab1/L1_Sampling/" class="md-nav__link">
        L1 Sampling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Diffusion/Lab2/L2_Training/" class="md-nav__link">
        L2 Training
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Diffusion/Lab3/L3_Context/" class="md-nav__link">
        L3 Context
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Diffusion/Lab4/L4_FastSampling/" class="md-nav__link">
        L4 FastSampling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          Prompt
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Prompt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l2-guidelines/" class="md-nav__link">
        L2 guidelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l4-summarizing/" class="md-nav__link">
        L4 summarizing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l5-inferring/" class="md-nav__link">
        L5 inferring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l6-transforming/" class="md-nav__link">
        L6 transforming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l7-expanding/" class="md-nav__link">
        L7 expanding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l8-chatbot/" class="md-nav__link">
        L8 chatbot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="week-3-assignment-image-segmentation-of-handwritten-digits">Week 3 Assignment: Image Segmentation of Handwritten Digits</h1>
<p><img src='https://drive.google.com/uc?export=view&id=1-WBX7w_R9abwdGmAUBFWWEcJ0LkMppq2' alt='m2nist digits'></p>
<p>In this week's assignment, you will build a model that predicts the segmentation masks (pixel-wise label map) of handwritten digits. This model will be trained on the <a href="https://www.kaggle.com/farhanhubble/multimnistm2nist">M2NIST dataset</a>, a multi digit MNIST. If you've done the ungraded lab on the CamVid dataset, then many of the steps here will look familiar.</p>
<p>You will build a Convolutional Neural Network (CNN) from scratch for the downsampling path and use a Fully Convolutional Network, FCN-8, to upsample and produce the pixel-wise label map. The model will be evaluated using the intersection over union (IOU) and Dice Score. Finally, you will download the model and upload it to the grader in Coursera to get your score for the assignment.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="exercises">Exercises</h2>
<p>We've given you some boilerplate code to work with and these are the 5 exercises you need to fill out before you can successfully get the segmentation masks.</p>
<ul>
<li><a href="#exercise-1">Exercise 1 - Define the Basic Convolution Block</a></li>
<li><a href="#exercise-2">Exercise 2 - Define the Downsampling Path</a></li>
<li><a href="#exercise-3">Exercise 3 - Define the FCN-8 decoder</a></li>
<li><a href="#exercise-4">Exercise 4 - Compile the Model</a></li>
<li><a href="#exercise-5">Exercise 5 - Model Training</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="imports">Imports</h2>
<p>As usual, let's start by importing the packages you will use in this lab.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Install packages for compatibility with the autograder</span>

<span class="c1"># NOTE: You can safely ignore errors about version incompatibility of</span>
<span class="c1"># Colab-bundled packages (e.g. xarray, pydantic, etc.)</span>

<span class="c1"># !pip install tensorflow==2.6.0 --quiet</span>
<span class="c1"># !pip install keras==2.6 --quiet</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
  <span class="c1"># %tensorflow_version only exists in Colab.</span>
  <span class="o">%</span><span class="n">tensorflow_version</span> <span class="mf">2.</span><span class="n">x</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
  <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">zipfile</span>

<span class="kn">import</span> <span class="nn">PIL.Image</span><span class="o">,</span> <span class="nn">PIL.ImageFont</span><span class="o">,</span> <span class="nn">PIL.ImageDraw</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="nn">tfds</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tensorflow version &quot;</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>2023-04-03 08:59:41.424454: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>Tensorflow version 2.11.0
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="download-the-dataset">Download the dataset</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://www.kaggle.com/farhanhubble/multimnistm2nist">M2NIST</a> is a <strong>multi digit</strong> <a href="http://yann.lecun.com/exdb/mnist/">MNIST</a>. 
Each image has up to 3 digits from MNIST digits and the corresponding labels file has the segmentation masks.</p>
<p>The dataset is available on <a href="https://www.kaggle.com">Kaggle</a> and you can find it <a href="https://www.kaggle.com/farhanhubble/multimnistm2nist">here</a></p>
<p>To make it easier for you, we're hosting it on Google Cloud so you can download without Kaggle credentials.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># download zipped dataset</span>
<span class="err">!</span><span class="n">wget</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">check</span><span class="o">-</span><span class="n">certificate</span> \
    <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">public</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">temp</span><span class="o">/</span><span class="n">m2nist</span><span class="o">.</span><span class="n">zip</span> \
    <span class="o">-</span><span class="n">O</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">m2nist</span><span class="o">.</span><span class="n">zip</span>

<span class="c1"># find and extract to a local folder (&#39;/tmp/training&#39;)</span>
<span class="n">local_zip</span> <span class="o">=</span> <span class="s1">&#39;/tmp/m2nist.zip&#39;</span>
<span class="n">zip_ref</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">local_zip</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;/tmp/training&#39;</span><span class="p">)</span>
<span class="n">zip_ref</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>--2023-04-03 09:04:49--  https://storage.googleapis.com/tensorflow-1-public/tensorflow-3-temp/m2nist.zip
Resolving storage.googleapis.com (storage.googleapis.com)... 2404:6800:4002:813::2010, 2404:6800:4002:814::2010, 2404:6800:4002:815::2010, ...
Connecting to storage.googleapis.com (storage.googleapis.com)|2404:6800:4002:813::2010|:443... ^C
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">BadZipFile</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[3], line 6</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> # find and extract to a local folder (&#39;/tmp/training&#39;)
<span class="ansi-green-intense-fg ansi-bold">      5</span> local_zip = &#39;/tmp/m2nist.zip&#39;
<span class="ansi-green-fg">----&gt; 6</span> zip_ref = zipfile.ZipFile(local_zip, &#39;r&#39;)
<span class="ansi-green-intense-fg ansi-bold">      7</span> zip_ref.extractall(&#39;/tmp/training&#39;)
<span class="ansi-green-intense-fg ansi-bold">      8</span> zip_ref.close()

File <span class="ansi-green-fg">~/anaconda3/envs/data-science/lib/python3.9/zipfile.py:1266</span>, in <span class="ansi-cyan-fg">ZipFile.__init__</span><span class="ansi-blue-fg">(self, file, mode, compression, allowZip64, compresslevel, strict_timestamps)</span>
<span class="ansi-green-intense-fg ansi-bold">   1264</span> try:
<span class="ansi-green-intense-fg ansi-bold">   1265</span>     if mode == &#39;r&#39;:
<span class="ansi-green-fg">-&gt; 1266</span>         self._RealGetContents()
<span class="ansi-green-intense-fg ansi-bold">   1267</span>     elif mode in (&#39;w&#39;, &#39;x&#39;):
<span class="ansi-green-intense-fg ansi-bold">   1268</span>         # set the modified flag so central directory gets written
<span class="ansi-green-intense-fg ansi-bold">   1269</span>         # even if no files are added to the archive
<span class="ansi-green-intense-fg ansi-bold">   1270</span>         self._didModify = True

File <span class="ansi-green-fg">~/anaconda3/envs/data-science/lib/python3.9/zipfile.py:1333</span>, in <span class="ansi-cyan-fg">ZipFile._RealGetContents</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1331</span>     raise BadZipFile(&#34;File is not a zip file&#34;)
<span class="ansi-green-intense-fg ansi-bold">   1332</span> if not endrec:
<span class="ansi-green-fg">-&gt; 1333</span>     raise BadZipFile(&#34;File is not a zip file&#34;)
<span class="ansi-green-intense-fg ansi-bold">   1334</span> if self.debug &gt; 1:
<span class="ansi-green-intense-fg ansi-bold">   1335</span>     print(endrec)

<span class="ansi-red-fg">BadZipFile</span>: File is not a zip file</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="load-and-preprocess-the-dataset">Load and Preprocess the Dataset</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This dataset can be easily preprocessed since it is available as <strong>Numpy Array Files (.npy)</strong></p>
<ol>
<li>
<p><strong>combined.npy</strong> has the image files containing the multiple MNIST digits. Each image is of size <strong>64 x 84</strong> (height x width, in pixels).</p>
</li>
<li>
<p><strong>segmented.npy</strong> has the corresponding segmentation masks. Each segmentation mask is also of size <strong>64 x 84</strong>.</p>
</li>
</ol>
<p>This dataset has <strong>5000</strong> samples and you can make appropriate training, validation, and test splits as required for the problem.</p>
<p>With that, let's define a few utility functions for loading and preprocessing the dataset.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">32</span>

<span class="k">def</span> <span class="nf">read_image_and_annotation</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Casts the image and annotation to their expected data type and</span>
<span class="sd">  normalizes the input image so that each pixel is in the range [-1, 1]</span>

<span class="sd">  Args:</span>
<span class="sd">    image (numpy array) -- input image</span>
<span class="sd">    annotation (numpy array) -- ground truth label map</span>

<span class="sd">  Returns:</span>
<span class="sd">    preprocessed image-annotation pair</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,))</span>
  <span class="n">annotation</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">/</span> <span class="mf">127.5</span>
  <span class="n">image</span> <span class="o">-=</span> <span class="mi">1</span>

  <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">annotation</span>


<span class="k">def</span> <span class="nf">get_training_dataset</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">annos</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Prepares shuffled batches of the training set.</span>

<span class="sd">  Args:</span>
<span class="sd">    images (list of strings) -- paths to each image file in the train set</span>
<span class="sd">    annos (list of strings) -- paths to each label map in the train set</span>

<span class="sd">  Returns:</span>
<span class="sd">    tf Dataset containing the preprocessed train set</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">training_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">images</span><span class="p">,</span> <span class="n">annos</span><span class="p">))</span>
  <span class="n">training_dataset</span> <span class="o">=</span> <span class="n">training_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">read_image_and_annotation</span><span class="p">)</span>

  <span class="n">training_dataset</span> <span class="o">=</span> <span class="n">training_dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">reshuffle_each_iteration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">training_dataset</span> <span class="o">=</span> <span class="n">training_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
  <span class="n">training_dataset</span> <span class="o">=</span> <span class="n">training_dataset</span><span class="o">.</span><span class="n">repeat</span><span class="p">()</span>
  <span class="n">training_dataset</span> <span class="o">=</span> <span class="n">training_dataset</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">training_dataset</span>


<span class="k">def</span> <span class="nf">get_validation_dataset</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">annos</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Prepares batches of the validation set.</span>

<span class="sd">  Args:</span>
<span class="sd">    images (list of strings) -- paths to each image file in the val set</span>
<span class="sd">    annos (list of strings) -- paths to each label map in the val set</span>

<span class="sd">  Returns:</span>
<span class="sd">    tf Dataset containing the preprocessed validation set</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">images</span><span class="p">,</span> <span class="n">annos</span><span class="p">))</span>
  <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">validation_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">read_image_and_annotation</span><span class="p">)</span>
  <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">validation_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
  <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">validation_dataset</span><span class="o">.</span><span class="n">repeat</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">validation_dataset</span>


<span class="k">def</span> <span class="nf">get_test_dataset</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">annos</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Prepares batches of the test set.</span>

<span class="sd">  Args:</span>
<span class="sd">    images (list of strings) -- paths to each image file in the test set</span>
<span class="sd">    annos (list of strings) -- paths to each label map in the test set</span>

<span class="sd">  Returns:</span>
<span class="sd">    tf Dataset containing the preprocessed validation set</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">images</span><span class="p">,</span> <span class="n">annos</span><span class="p">))</span>
  <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">read_image_and_annotation</span><span class="p">)</span>
  <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="n">drop_remainder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">test_dataset</span>


<span class="k">def</span> <span class="nf">load_images_and_segments</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Loads the images and segments as numpy arrays from npy files </span>
<span class="sd">  and makes splits for training, validation and test datasets.</span>

<span class="sd">  Returns:</span>
<span class="sd">    3 tuples containing the train, val, and test splits</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="c1">#Loads images and segmentation masks.</span>
  <span class="n">images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;/tmp/training/combined.npy&#39;</span><span class="p">)</span>
  <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;/tmp/training/segmented.npy&#39;</span><span class="p">)</span>

  <span class="c1">#Makes training, validation, test splits from loaded images and segmentation masks.</span>
  <span class="n">train_images</span><span class="p">,</span> <span class="n">val_images</span><span class="p">,</span> <span class="n">train_annos</span><span class="p">,</span> <span class="n">val_annos</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">val_images</span><span class="p">,</span> <span class="n">test_images</span><span class="p">,</span> <span class="n">val_annos</span><span class="p">,</span> <span class="n">test_annos</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">val_images</span><span class="p">,</span> <span class="n">val_annos</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">return</span> <span class="p">(</span><span class="n">train_images</span><span class="p">,</span> <span class="n">train_annos</span><span class="p">),</span> <span class="p">(</span><span class="n">val_images</span><span class="p">,</span> <span class="n">val_annos</span><span class="p">),</span> <span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="n">test_annos</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can now load the preprocessed dataset and define the training, validation, and test sets.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Load Dataset</span>
<span class="n">train_slices</span><span class="p">,</span> <span class="n">val_slices</span><span class="p">,</span> <span class="n">test_slices</span> <span class="o">=</span> <span class="n">load_images_and_segments</span><span class="p">()</span>

<span class="c1"># Create training, validation, test datasets.</span>
<span class="n">training_dataset</span> <span class="o">=</span> <span class="n">get_training_dataset</span><span class="p">(</span><span class="n">train_slices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">train_slices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">get_validation_dataset</span><span class="p">(</span><span class="n">val_slices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">val_slices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">get_test_dataset</span><span class="p">(</span><span class="n">test_slices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">test_slices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="lets-take-a-look-at-the-dataset">Let's Take a Look at the Dataset</h2>
<p>You may want to visually inspect the dataset before and after training. Like above, we've included utility functions to help show a few images as well as their annotations (i.e. labels).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Visualization Utilities</span>

<span class="c1"># there are 11 classes in the dataset: one class for each digit (0 to 9) plus the background class</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="mi">11</span>

<span class="c1"># assign a random color for each class</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">fuse_with_pil</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Creates a blank image and pastes input images</span>

<span class="sd">  Args:</span>
<span class="sd">    images (list of numpy arrays) - numpy array representations of the images to paste</span>

<span class="sd">  Returns:</span>
<span class="sd">    PIL Image object containing the images</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">widths</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">)</span>
  <span class="n">heights</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">)</span>
  <span class="n">total_width</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">widths</span><span class="p">)</span>
  <span class="n">max_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">heights</span><span class="p">)</span>

  <span class="n">new_im</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">total_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">))</span>

  <span class="n">x_offset</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
    <span class="n">pil_image</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">im</span><span class="p">))</span>
    <span class="n">new_im</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">pil_image</span><span class="p">,</span> <span class="p">(</span><span class="n">x_offset</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">x_offset</span> <span class="o">+=</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">new_im</span>


<span class="k">def</span> <span class="nf">give_color_to_annotation</span><span class="p">(</span><span class="n">annotation</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Converts a 2-D annotation to a numpy array with shape (height, width, 3) where</span>
<span class="sd">  the third axis represents the color channel. The label values are multiplied by</span>
<span class="sd">  255 and placed in this axis to give color to the annotation</span>

<span class="sd">  Args:</span>
<span class="sd">    annotation (numpy array) - label map array</span>

<span class="sd">  Returns:</span>
<span class="sd">    the annotation array with an additional color channel/axis</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">seg_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
    <span class="n">segc</span> <span class="o">=</span> <span class="p">(</span><span class="n">annotation</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">seg_img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">segc</span><span class="o">*</span><span class="p">(</span> <span class="n">colors</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">)</span>
    <span class="n">seg_img</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">segc</span><span class="o">*</span><span class="p">(</span> <span class="n">colors</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">)</span>
    <span class="n">seg_img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">segc</span><span class="o">*</span><span class="p">(</span> <span class="n">colors</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">seg_img</span>


<span class="k">def</span> <span class="nf">show_annotation_and_prediction</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">annotation</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">iou_list</span><span class="p">,</span> <span class="n">dice_score_list</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Displays the images with the ground truth and predicted label maps. Also overlays the metrics.</span>

<span class="sd">  Args:</span>
<span class="sd">    image (numpy array) -- the input image</span>
<span class="sd">    annotation (numpy array) -- the ground truth label map</span>
<span class="sd">    prediction (numpy array) -- the predicted label map</span>
<span class="sd">    iou_list (list of floats) -- the IOU values for each class</span>
<span class="sd">    dice_score_list (list of floats) -- the Dice Score for each class</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">new_ann</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">true_img</span> <span class="o">=</span> <span class="n">give_color_to_annotation</span><span class="p">(</span><span class="n">new_ann</span><span class="p">)</span>
  <span class="n">pred_img</span> <span class="o">=</span> <span class="n">give_color_to_annotation</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>

  <span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">*</span> <span class="mf">127.5</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],))</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
  <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">pred_img</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">true_img</span><span class="p">)]</span>

  <span class="n">metrics_by_id</span> <span class="o">=</span> <span class="p">[(</span><span class="n">idx</span><span class="p">,</span> <span class="n">iou</span><span class="p">,</span> <span class="n">dice_score</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">iou</span><span class="p">,</span> <span class="n">dice_score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">iou_list</span><span class="p">,</span> <span class="n">dice_score_list</span><span class="p">))</span> <span class="k">if</span> <span class="n">iou</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">]</span>
  <span class="n">metrics_by_id</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># sorts in place</span>

  <span class="n">display_string_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: IOU: </span><span class="si">{}</span><span class="s2"> Dice Score: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">iou</span><span class="p">,</span> <span class="n">dice_score</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">iou</span><span class="p">,</span> <span class="n">dice_score</span> <span class="ow">in</span> <span class="n">metrics_by_id</span><span class="p">]</span>
  <span class="n">display_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">display_string_list</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

  <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">display_string</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">show_annotation_and_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">annotation</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Displays the image and its annotation side by side</span>

<span class="sd">  Args:</span>
<span class="sd">    image (numpy array) -- the input image</span>
<span class="sd">    annotation (numpy array) -- the label map</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">new_ann</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">seg_img</span> <span class="o">=</span> <span class="n">give_color_to_annotation</span><span class="p">(</span><span class="n">new_ann</span><span class="p">)</span>

  <span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">*</span> <span class="mf">127.5</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],))</span>

  <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
  <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">,</span> <span class="n">seg_img</span><span class="p">]</span>

  <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">,</span> <span class="n">seg_img</span><span class="p">]</span>
  <span class="n">fused_img</span> <span class="o">=</span> <span class="n">fuse_with_pil</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fused_img</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">list_show_annotation</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">num_images</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Displays images and its annotations side by side</span>

<span class="sd">  Args:</span>
<span class="sd">    dataset (tf Dataset) -- batch of images and annotations</span>
<span class="sd">    num_images (int) -- number of images to display</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">ds</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">unbatch</span><span class="p">()</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Images And Annotations&quot;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">annotation</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">num_images</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">show_annotation_and_image</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">annotation</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can view a subset of the images from the dataset with the <code>list_show_annotation()</code> function defined above. Run the cells below to see the image on the left and its pixel-wise ground truth label map on the right.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># get 10 images from the training set</span>
<span class="n">list_show_annotation</span><span class="p">(</span><span class="n">training_dataset</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># get 10 images from the validation set</span>
<span class="n">list_show_annotation</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You see from the images above the colors assigned to each class (i.e 0 to 9 plus the background). If you don't like these colors, feel free to rerun the cell where <code>colors</code> is defined to get another set of random colors. Alternatively, you can assign the RGB values for each class instead of relying on random values.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="define-the-model">Define the Model</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As discussed in the lectures, the image segmentation model will have two paths:</p>
<ol>
<li>
<p><strong>Downsampling Path</strong> - This part of the network extracts the features in the image. This is done through a series of convolution and pooling layers. The final output is a reduced image (because of the pooling layers) with the extracted features. You will build a custom CNN from scratch for this path.</p>
</li>
<li>
<p><strong>Upsampling Path</strong> - This takes the output of the downsampling path and generates the predictions while also converting the image back to its original size. You will use an FCN-8 decoder for this path.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="define-the-basic-convolution-block">Define the Basic Convolution Block</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-1'></a></p>
<h4 id="exercise-1"><strong>Exercise 1</strong></h4>
<p>Please complete the function below to build the basic convolution block for our CNN. This will have two <a href="https://keras.io/api/layers/convolution_layers/convolution2d/">Conv2D</a> layers each followed by a <a href="https://keras.io/api/layers/activation_layers/leaky_relu/">LeakyReLU</a>, then <a href="https://keras.io/api/layers/pooling_layers/max_pooling2d/">max pooled</a> and <a href="https://keras.io/api/layers/normalization_layers/batch_normalization/">batch-normalized</a>. Use the functional syntax to stack these layers.</p>
<div class="arithmatex">\[Input -&gt; Conv2D -&gt; LeakyReLU -&gt; Conv2D -&gt; LeakyReLU -&gt; MaxPooling2D -&gt; BatchNormalization\]</div>
<p>When defining the Conv2D layers, note that our data inputs will have the 'channels' dimension last. You may want to check the <code>data_format</code> argument in the <a href="https://keras.io/api/layers/convolution_layers/convolution2d/">docs</a> regarding this. Take note of the <code>padding</code> argument too like you did in the ungraded labs.</p>
<p>Lastly, to use the <code>LeakyReLU</code> activation, you <strong>do not</strong> need to nest it inside an <code>Activation</code> layer (e.g. <code>x = tf.keras.layers.Activation(tf.keras.layers.LeakyReLU()(x)</code>). You can simply stack the layer directly instead (e.g. <code>x = tf.keras.layers.LeakyReLU()(x)</code>)</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># parameter describing where the channel dimension is found in our dataset</span>
<span class="n">IMAGE_ORDERING</span> <span class="o">=</span> <span class="s1">&#39;channels_last&#39;</span>

<span class="k">def</span> <span class="nf">conv_block</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">,</span> <span class="n">pool_strides</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Args:</span>
<span class="sd">    input (tensor) -- batch of images or features</span>
<span class="sd">    filters (int) -- number of filters of the Conv2D layers</span>
<span class="sd">    kernel_size (int) -- kernel_size setting of the Conv2D layers</span>
<span class="sd">    pooling_size (int) -- pooling size of the MaxPooling2D layers</span>
<span class="sd">    pool_strides (int) -- strides setting of the MaxPooling2D layers</span>

<span class="sd">  Returns:</span>
<span class="sd">    (tensor) max pooled and batch-normalized features of the input </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="c1">### START CODE HERE ###</span>
  <span class="c1"># use the functional syntax to stack the layers as shown in the diagram above</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">IMAGE_ORDERING</span><span class="p">)(</span><span class="nb">input</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">IMAGE_ORDERING</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="n">pooling_size</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="n">pool_strides</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">IMAGE_ORDERING</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">BatchNormalization</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
  <span class="c1">### END CODE HERE ###</span>

  <span class="k">return</span> <span class="n">x</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># TEST CODE:</span>

<span class="n">test_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">test_output</span> <span class="o">=</span> <span class="n">conv_block</span><span class="p">(</span><span class="n">test_input</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">test_input</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">test_output</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">test_model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="c1"># free up test resources</span>
<span class="k">del</span> <span class="n">test_input</span><span class="p">,</span> <span class="n">test_output</span><span class="p">,</span> <span class="n">test_model</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>Model: &#34;model&#34;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 input_1 (InputLayer)        [(None, 64, 84, 1)]       0         

 conv2d (Conv2D)             (None, 64, 84, 32)        320       

 leaky_re_lu (LeakyReLU)     (None, 64, 84, 32)        0         

 conv2d_1 (Conv2D)           (None, 64, 84, 32)        9248      

 leaky_re_lu_1 (LeakyReLU)   (None, 64, 84, 32)        0         

 max_pooling2d (MaxPooling2D  (None, 32, 42, 32)       0         
 )                                                               

 batch_normalization (BatchN  (None, 32, 42, 32)       128       
 ormalization)                                                   

=================================================================
Total params: 9,696
Trainable params: 9,632
Non-trainable params: 64
_________________________________________________________________
None
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>2023-04-03 09:08:51.414197: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output</strong>:</p>
<p>Please pay attention to the <em>(type)</em> and <em>Output Shape</em> columns. The <em>Layer</em> name beside the type may be different depending on how many times you ran the cell (e.g. <code>input_7</code> can be <code>input_1</code>)</p>
<div class="highlight"><pre><span></span><code>Model: &quot;functional_1&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input_1 (InputLayer)         [(None, 64, 84, 1)]       0         
_________________________________________________________________
conv2d (Conv2D)              (None, 64, 84, 32)        320       
_________________________________________________________________
leaky_re_lu (LeakyReLU)      (None, 64, 84, 32)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 64, 84, 32)        9248      
_________________________________________________________________
leaky_re_lu_1 (LeakyReLU)    (None, 64, 84, 32)        0         
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 32, 42, 32)        0         
_________________________________________________________________
batch_normalization (BatchNo (None, 32, 42, 32)        128       
=================================================================
Total params: 9,696
Trainable params: 9,632
Non-trainable params: 64
_________________________________________________________________
None
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="define-the-downsampling-path">Define the Downsampling Path</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-2'></a></p>
<h4 id="exercise-2"><strong>Exercise 2</strong></h4>
<p>Now that we've defined the building block of our encoder, you can now build the downsampling path. Please complete the function below to create the encoder. This should chain together five convolution building blocks to create a feature extraction CNN minus the fully connected layers.</p>
<p><em>Notes</em>: 
1. To optimize processing or to make the output dimensions of each layer easier to work with, it is sometimes advisable to apply some zero-padding to the input image. With the boilerplate code we have provided below, we have padded the input width to 96 pixels using the <a href="https://keras.io/api/layers/reshaping_layers/zero_padding2d/">ZeroPadding2D layer</a>. This works well if you're going to use the first ungraded lab of this week as reference. This is not required however. You can remove it later and see how it will affect your parameters. For instance, you might need to pass in a non-square kernel size to the decoder in Exercise 3 (e.g. <code>(4,5)</code>) to match the output dimensions of Exercise 2. </p>
<ol>
<li>We recommend keeping the pool size and stride parameters constant at 2.</li>
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">FCN8</span><span class="p">(</span><span class="n">input_height</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">input_width</span><span class="o">=</span><span class="mi">84</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Defines the downsampling path of the image segmentation model.</span>

<span class="sd">    Args:</span>
<span class="sd">      input_height (int) -- height of the images</span>
<span class="sd">      width (int) -- width of the images</span>

<span class="sd">    Returns:</span>
<span class="sd">    (tuple of tensors, tensor)</span>
<span class="sd">      tuple of tensors -- features extracted at blocks 3 to 5</span>
<span class="sd">      tensor -- copy of the input</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">img_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_height</span><span class="p">,</span><span class="n">input_width</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1">### START CODE HERE ###</span>

    <span class="c1"># pad the input image width to 96 pixels</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">ZeroPadding2D</span><span class="p">(((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">96</span><span class="o">-</span><span class="n">input_width</span><span class="p">)))(</span><span class="n">img_input</span><span class="p">)</span>

    <span class="c1"># Block 1</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">conv_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Block 2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">conv_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Block 3</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">conv_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># save the feature map at this stage</span>
    <span class="n">f3</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># Block 4</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">conv_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># save the feature map at this stage</span>
    <span class="n">f4</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># Block 5</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">conv_block</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># save the feature map at this stage</span>
    <span class="n">f5</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="n">f5</span><span class="p">),</span> <span class="n">img_input</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># TEST CODE:</span>

<span class="n">test_convs</span><span class="p">,</span> <span class="n">test_img_input</span> <span class="o">=</span> <span class="n">FCN8</span><span class="p">()</span>
<span class="n">test_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">test_img_input</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">test_convs</span><span class="p">,</span> <span class="n">test_img_input</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">test_model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="k">del</span> <span class="n">test_convs</span><span class="p">,</span> <span class="n">test_img_input</span><span class="p">,</span> <span class="n">test_model</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>Model: &#34;model_3&#34;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 input_4 (InputLayer)        [(None, 64, 84, 1)]       0         

 zero_padding2d_2 (ZeroPaddi  (None, 64, 96, 1)        0         
 ng2D)                                                           

 conv2d_22 (Conv2D)          (None, 64, 96, 32)        320       

 leaky_re_lu_22 (LeakyReLU)  (None, 64, 96, 32)        0         

 conv2d_23 (Conv2D)          (None, 64, 96, 32)        9248      

 leaky_re_lu_23 (LeakyReLU)  (None, 64, 96, 32)        0         

 max_pooling2d_11 (MaxPoolin  (None, 32, 48, 32)       0         
 g2D)                                                            

 batch_normalization_11 (Bat  (None, 32, 48, 32)       128       
 chNormalization)                                                

 conv2d_24 (Conv2D)          (None, 32, 48, 64)        18496     

 leaky_re_lu_24 (LeakyReLU)  (None, 32, 48, 64)        0         

 conv2d_25 (Conv2D)          (None, 32, 48, 64)        36928     

 leaky_re_lu_25 (LeakyReLU)  (None, 32, 48, 64)        0         

 max_pooling2d_12 (MaxPoolin  (None, 16, 24, 64)       0         
 g2D)                                                            

 batch_normalization_12 (Bat  (None, 16, 24, 64)       256       
 chNormalization)                                                

 conv2d_26 (Conv2D)          (None, 16, 24, 128)       73856     

 leaky_re_lu_26 (LeakyReLU)  (None, 16, 24, 128)       0         

 conv2d_27 (Conv2D)          (None, 16, 24, 128)       147584    

 leaky_re_lu_27 (LeakyReLU)  (None, 16, 24, 128)       0         

 max_pooling2d_13 (MaxPoolin  (None, 8, 12, 128)       0         
 g2D)                                                            

 batch_normalization_13 (Bat  (None, 8, 12, 128)       512       
 chNormalization)                                                

 conv2d_28 (Conv2D)          (None, 8, 12, 256)        295168    

 leaky_re_lu_28 (LeakyReLU)  (None, 8, 12, 256)        0         

 conv2d_29 (Conv2D)          (None, 8, 12, 256)        590080    

 leaky_re_lu_29 (LeakyReLU)  (None, 8, 12, 256)        0         

 max_pooling2d_14 (MaxPoolin  (None, 4, 6, 256)        0         
 g2D)                                                            

 batch_normalization_14 (Bat  (None, 4, 6, 256)        1024      
 chNormalization)                                                

 conv2d_30 (Conv2D)          (None, 4, 6, 256)         590080    

 leaky_re_lu_30 (LeakyReLU)  (None, 4, 6, 256)         0         

 conv2d_31 (Conv2D)          (None, 4, 6, 256)         590080    

 leaky_re_lu_31 (LeakyReLU)  (None, 4, 6, 256)         0         

 max_pooling2d_15 (MaxPoolin  (None, 2, 3, 256)        0         
 g2D)                                                            

 batch_normalization_15 (Bat  (None, 2, 3, 256)        1024      
 chNormalization)                                                

=================================================================
Total params: 2,354,784
Trainable params: 2,353,312
Non-trainable params: 1,472
_________________________________________________________________
None
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output</strong>:</p>
<p>You should see the layers of your <code>conv_block()</code> being repeated 5 times like the output below.</p>
<div class="highlight"><pre><span></span><code>Model: &quot;functional_3&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input_3 (InputLayer)         [(None, 64, 84, 1)]       0         
_________________________________________________________________
zero_padding2d (ZeroPadding2 (None, 64, 96, 1)         0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 64, 96, 32)        320       
_________________________________________________________________
leaky_re_lu_2 (LeakyReLU)    (None, 64, 96, 32)        0         
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 64, 96, 32)        9248      
_________________________________________________________________
leaky_re_lu_3 (LeakyReLU)    (None, 64, 96, 32)        0         
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 32, 48, 32)        0         
_________________________________________________________________
batch_normalization_1 (Batch (None, 32, 48, 32)        128       
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 32, 48, 64)        18496     
_________________________________________________________________
leaky_re_lu_4 (LeakyReLU)    (None, 32, 48, 64)        0         
_________________________________________________________________
conv2d_5 (Conv2D)            (None, 32, 48, 64)        36928     
_________________________________________________________________
leaky_re_lu_5 (LeakyReLU)    (None, 32, 48, 64)        0         
_________________________________________________________________
max_pooling2d_2 (MaxPooling2 (None, 16, 24, 64)        0         
_________________________________________________________________
batch_normalization_2 (Batch (None, 16, 24, 64)        256       
_________________________________________________________________
conv2d_6 (Conv2D)            (None, 16, 24, 128)       73856     
_________________________________________________________________
leaky_re_lu_6 (LeakyReLU)    (None, 16, 24, 128)       0         
_________________________________________________________________
conv2d_7 (Conv2D)            (None, 16, 24, 128)       147584    
_________________________________________________________________
leaky_re_lu_7 (LeakyReLU)    (None, 16, 24, 128)       0         
_________________________________________________________________
max_pooling2d_3 (MaxPooling2 (None, 8, 12, 128)        0         
_________________________________________________________________
batch_normalization_3 (Batch (None, 8, 12, 128)        512       
_________________________________________________________________
conv2d_8 (Conv2D)            (None, 8, 12, 256)        295168    
_________________________________________________________________
leaky_re_lu_8 (LeakyReLU)    (None, 8, 12, 256)        0         
_________________________________________________________________
conv2d_9 (Conv2D)            (None, 8, 12, 256)        590080    
_________________________________________________________________
leaky_re_lu_9 (LeakyReLU)    (None, 8, 12, 256)        0         
_________________________________________________________________
max_pooling2d_4 (MaxPooling2 (None, 4, 6, 256)         0         
_________________________________________________________________
batch_normalization_4 (Batch (None, 4, 6, 256)         1024      
_________________________________________________________________
conv2d_10 (Conv2D)           (None, 4, 6, 256)         590080    
_________________________________________________________________
leaky_re_lu_10 (LeakyReLU)   (None, 4, 6, 256)         0         
_________________________________________________________________
conv2d_11 (Conv2D)           (None, 4, 6, 256)         590080    
_________________________________________________________________
leaky_re_lu_11 (LeakyReLU)   (None, 4, 6, 256)         0         
_________________________________________________________________
max_pooling2d_5 (MaxPooling2 (None, 2, 3, 256)         0         
_________________________________________________________________
batch_normalization_5 (Batch (None, 2, 3, 256)         1024      
=================================================================
Total params: 2,354,784
Trainable params: 2,353,312
Non-trainable params: 1,472
_________________________________________________________________
None
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="define-the-fcn-8-decoder">Define the FCN-8 decoder</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-3'></a></p>
<h4 id="exercise-3"><strong>Exercise 3</strong></h4>
<p>Now you can define the upsampling path taking the outputs of convolutions at each stage as arguments. This will be very similar to what you did in the ungraded lab (VGG16-FCN8-CamVid) so you can refer to it if you need a refresher. 
* Note: remember to set the <code>data_format</code> parameter for the Conv2D layers. </p>
<p>Here is also the diagram you saw in class on how it should work:</p>
<p><img src='https://drive.google.com/uc?export=view&id=1lrqB4YegV8jXWNfyYAaeuFlwXIc54aRP' alt='fcn-8'></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fcn8_decoder</span><span class="p">(</span><span class="n">convs</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">):</span>
  <span class="c1"># features from the encoder stage</span>
  <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="n">f5</span> <span class="o">=</span> <span class="n">convs</span>

  <span class="c1"># number of filters</span>
  <span class="n">n</span> <span class="o">=</span> <span class="mi">512</span>

  <span class="c1"># add convolutional layers on top of the CNN extractor.</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">n</span> <span class="p">,</span> <span class="p">(</span><span class="mi">7</span> <span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span> <span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;conv6&quot;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">IMAGE_ORDERING</span><span class="p">)(</span><span class="n">f5</span><span class="p">)</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)(</span><span class="n">o</span><span class="p">)</span>

  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">n</span> <span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span> <span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;conv7&quot;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">IMAGE_ORDERING</span><span class="p">)(</span><span class="n">o</span><span class="p">)</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)(</span><span class="n">o</span><span class="p">)</span>

  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">n_classes</span><span class="p">,</span>  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span> <span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">IMAGE_ORDERING</span><span class="p">)(</span><span class="n">o</span><span class="p">)</span>


  <span class="c1"># Upsample `o` above and crop any extra pixels introduced</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2DTranspose</span><span class="p">(</span><span class="n">n_classes</span> <span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="p">,</span>  <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))(</span><span class="n">o</span><span class="p">)</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Cropping2D</span><span class="p">(</span><span class="n">cropping</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))(</span><span class="n">o</span><span class="p">)</span>

  <span class="c1"># load the pool 4 prediction and do a 1x1 convolution to reshape it to the same shape of `o` above</span>
  <span class="n">o2</span> <span class="o">=</span> <span class="n">f4</span>
  <span class="n">o2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">n_classes</span> <span class="p">,</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span> <span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))(</span><span class="n">o2</span><span class="p">)</span>

  <span class="c1"># add the results of the upsampling and pool 4 prediction</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Add</span><span class="p">()([</span><span class="n">o</span><span class="p">,</span> <span class="n">o2</span><span class="p">])</span>

  <span class="c1"># upsample the resulting tensor of the operation you just did</span>
  <span class="n">o</span> <span class="o">=</span>  <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2DTranspose</span><span class="p">(</span> <span class="n">n_classes</span> <span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="p">,</span>  <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)))(</span><span class="n">o</span><span class="p">)</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Cropping2D</span><span class="p">(</span><span class="n">cropping</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))(</span><span class="n">o</span><span class="p">)</span>

  <span class="c1"># load the pool 3 prediction and do a 1x1 convolution to reshape it to the same shape of `o` above</span>
  <span class="n">o2</span> <span class="o">=</span>  <span class="n">f3</span>
  <span class="n">o2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">n_classes</span> <span class="p">,</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span> <span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="n">IMAGE_ORDERING</span><span class="p">)(</span><span class="n">o2</span><span class="p">)</span>

  <span class="c1"># add the results of the upsampling and pool 3 prediction</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Add</span><span class="p">()([</span><span class="n">o</span><span class="p">,</span> <span class="n">o2</span><span class="p">])</span>

  <span class="c1"># upsample up to the size of the original image</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2DTranspose</span><span class="p">(</span><span class="n">n_classes</span> <span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span> <span class="p">,</span>  <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))(</span><span class="n">o</span><span class="p">)</span>
  <span class="n">o</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Cropping2D</span><span class="p">(((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">96</span><span class="o">-</span><span class="mi">84</span><span class="p">)))(</span><span class="n">o</span><span class="p">)</span>

  <span class="c1"># append a sigmoid activation</span>
  <span class="n">o</span> <span class="o">=</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">))(</span><span class="n">o</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">o</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># TEST CODE</span>

<span class="n">test_convs</span><span class="p">,</span> <span class="n">test_img_input</span> <span class="o">=</span> <span class="n">FCN8</span><span class="p">()</span>
<span class="n">test_fcn8_decoder</span> <span class="o">=</span> <span class="n">fcn8_decoder</span><span class="p">(</span><span class="n">test_convs</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">test_fcn8_decoder</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">del</span> <span class="n">test_convs</span><span class="p">,</span> <span class="n">test_img_input</span><span class="p">,</span> <span class="n">test_fcn8_decoder</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>(None, 64, 84, 11)
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output:</strong></p>
<div class="highlight"><pre><span></span><code>(None, 64, 84, 11)
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="define-the-complete-model">Define the Complete Model</h3>
<p>The downsampling and upsampling paths can now be combined as shown below.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># start the encoder using the default input size 64 x 84</span>
<span class="n">convs</span><span class="p">,</span> <span class="n">img_input</span> <span class="o">=</span> <span class="n">FCN8</span><span class="p">()</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="mi">11</span>
<span class="c1"># pass the convolutions obtained in the encoder to the decoder</span>
<span class="n">dec_op</span> <span class="o">=</span> <span class="n">fcn8_decoder</span><span class="p">(</span><span class="n">convs</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>

<span class="c1"># define the model specifying the input (batch of images) and output (decoder output)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">img_input</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">dec_op</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>Model: &#34;model_4&#34;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_10 (InputLayer)          [(None, 64, 84, 1)]  0           []                               

 zero_padding2d_8 (ZeroPadding2  (None, 64, 96, 1)   0           [&#39;input_10[0][0]&#39;]               
 D)                                                                                               

 conv2d_92 (Conv2D)             (None, 64, 96, 32)   320         [&#39;zero_padding2d_8[0][0]&#39;]       

 leaky_re_lu_82 (LeakyReLU)     (None, 64, 96, 32)   0           [&#39;conv2d_92[0][0]&#39;]              

 conv2d_93 (Conv2D)             (None, 64, 96, 32)   9248        [&#39;leaky_re_lu_82[0][0]&#39;]         

 leaky_re_lu_83 (LeakyReLU)     (None, 64, 96, 32)   0           [&#39;conv2d_93[0][0]&#39;]              

 max_pooling2d_41 (MaxPooling2D  (None, 32, 48, 32)  0           [&#39;leaky_re_lu_83[0][0]&#39;]         
 )                                                                                                

 batch_normalization_41 (BatchN  (None, 32, 48, 32)  128         [&#39;max_pooling2d_41[0][0]&#39;]       
 ormalization)                                                                                    

 conv2d_94 (Conv2D)             (None, 32, 48, 64)   18496       [&#39;batch_normalization_41[0][0]&#39;] 

 leaky_re_lu_84 (LeakyReLU)     (None, 32, 48, 64)   0           [&#39;conv2d_94[0][0]&#39;]              

 conv2d_95 (Conv2D)             (None, 32, 48, 64)   36928       [&#39;leaky_re_lu_84[0][0]&#39;]         

 leaky_re_lu_85 (LeakyReLU)     (None, 32, 48, 64)   0           [&#39;conv2d_95[0][0]&#39;]              

 max_pooling2d_42 (MaxPooling2D  (None, 16, 24, 64)  0           [&#39;leaky_re_lu_85[0][0]&#39;]         
 )                                                                                                

 batch_normalization_42 (BatchN  (None, 16, 24, 64)  256         [&#39;max_pooling2d_42[0][0]&#39;]       
 ormalization)                                                                                    

 conv2d_96 (Conv2D)             (None, 16, 24, 128)  73856       [&#39;batch_normalization_42[0][0]&#39;] 

 leaky_re_lu_86 (LeakyReLU)     (None, 16, 24, 128)  0           [&#39;conv2d_96[0][0]&#39;]              

 conv2d_97 (Conv2D)             (None, 16, 24, 128)  147584      [&#39;leaky_re_lu_86[0][0]&#39;]         

 leaky_re_lu_87 (LeakyReLU)     (None, 16, 24, 128)  0           [&#39;conv2d_97[0][0]&#39;]              

 max_pooling2d_43 (MaxPooling2D  (None, 8, 12, 128)  0           [&#39;leaky_re_lu_87[0][0]&#39;]         
 )                                                                                                

 batch_normalization_43 (BatchN  (None, 8, 12, 128)  512         [&#39;max_pooling2d_43[0][0]&#39;]       
 ormalization)                                                                                    

 conv2d_98 (Conv2D)             (None, 8, 12, 256)   295168      [&#39;batch_normalization_43[0][0]&#39;] 

 leaky_re_lu_88 (LeakyReLU)     (None, 8, 12, 256)   0           [&#39;conv2d_98[0][0]&#39;]              

 conv2d_99 (Conv2D)             (None, 8, 12, 256)   590080      [&#39;leaky_re_lu_88[0][0]&#39;]         

 leaky_re_lu_89 (LeakyReLU)     (None, 8, 12, 256)   0           [&#39;conv2d_99[0][0]&#39;]              

 max_pooling2d_44 (MaxPooling2D  (None, 4, 6, 256)   0           [&#39;leaky_re_lu_89[0][0]&#39;]         
 )                                                                                                

 batch_normalization_44 (BatchN  (None, 4, 6, 256)   1024        [&#39;max_pooling2d_44[0][0]&#39;]       
 ormalization)                                                                                    

 conv2d_100 (Conv2D)            (None, 4, 6, 256)    590080      [&#39;batch_normalization_44[0][0]&#39;] 

 leaky_re_lu_90 (LeakyReLU)     (None, 4, 6, 256)    0           [&#39;conv2d_100[0][0]&#39;]             

 conv2d_101 (Conv2D)            (None, 4, 6, 256)    590080      [&#39;leaky_re_lu_90[0][0]&#39;]         

 leaky_re_lu_91 (LeakyReLU)     (None, 4, 6, 256)    0           [&#39;conv2d_101[0][0]&#39;]             

 max_pooling2d_45 (MaxPooling2D  (None, 2, 3, 256)   0           [&#39;leaky_re_lu_91[0][0]&#39;]         
 )                                                                                                

 batch_normalization_45 (BatchN  (None, 2, 3, 256)   1024        [&#39;max_pooling2d_45[0][0]&#39;]       
 ormalization)                                                                                    

 conv6 (Conv2D)                 (None, 2, 3, 512)    6423040     [&#39;batch_normalization_45[0][0]&#39;] 

 dropout_8 (Dropout)            (None, 2, 3, 512)    0           [&#39;conv6[0][0]&#39;]                  

 conv7 (Conv2D)                 (None, 2, 3, 512)    262656      [&#39;dropout_8[0][0]&#39;]              

 dropout_9 (Dropout)            (None, 2, 3, 512)    0           [&#39;conv7[0][0]&#39;]                  

 conv2d_102 (Conv2D)            (None, 2, 3, 11)     5643        [&#39;dropout_9[0][0]&#39;]              

 conv2d_transpose_9 (Conv2DTran  (None, 6, 8, 11)    1936        [&#39;conv2d_102[0][0]&#39;]             
 spose)                                                                                           

 cropping2d_8 (Cropping2D)      (None, 4, 6, 11)     0           [&#39;conv2d_transpose_9[0][0]&#39;]     

 conv2d_103 (Conv2D)            (None, 4, 6, 11)     2827        [&#39;batch_normalization_44[0][0]&#39;] 

 add_6 (Add)                    (None, 4, 6, 11)     0           [&#39;cropping2d_8[0][0]&#39;,           
                                                                  &#39;conv2d_103[0][0]&#39;]             

 conv2d_transpose_10 (Conv2DTra  (None, 10, 14, 11)  1936        [&#39;add_6[0][0]&#39;]                  
 nspose)                                                                                          

 cropping2d_9 (Cropping2D)      (None, 8, 12, 11)    0           [&#39;conv2d_transpose_10[0][0]&#39;]    

 conv2d_104 (Conv2D)            (None, 8, 12, 11)    1419        [&#39;batch_normalization_43[0][0]&#39;] 

 add_7 (Add)                    (None, 8, 12, 11)    0           [&#39;cropping2d_9[0][0]&#39;,           
                                                                  &#39;conv2d_104[0][0]&#39;]             

 conv2d_transpose_11 (Conv2DTra  (None, 64, 96, 11)  7744        [&#39;add_7[0][0]&#39;]                  
 nspose)                                                                                          

 cropping2d_10 (Cropping2D)     (None, 64, 84, 11)   0           [&#39;conv2d_transpose_11[0][0]&#39;]    

 activation_3 (Activation)      (None, 64, 84, 11)   0           [&#39;cropping2d_10[0][0]&#39;]          

==================================================================================================
Total params: 9,061,985
Trainable params: 9,060,513
Non-trainable params: 1,472
__________________________________________________________________________________________________
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="compile-the-model">Compile the Model</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-4'></a></p>
<h3 id="exercise-4"><strong>Exercise 4</strong></h3>
<p>Compile the model using an appropriate loss, optimizer, and metric.</p>
<p><em><strong>Note:</strong> There is a current issue with the grader accepting certain loss functions. We will be upgrading it but while in progress, please use this syntax:</em></p>
<div class="highlight"><pre><span></span><code>loss=&#39;&lt;loss string name&gt;&#39;
</code></pre></div>
<p><em>instead of:</em></p>
<div class="highlight"><pre><span></span><code>loss=tf.keras.losses.&lt;StringCassName&gt;
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE ###</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">&quot;categorical_crossentropy&quot;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;sgd&quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
<span class="c1">### END CODE HERE ###</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="model-training">Model Training</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-5'></a></p>
<h3 id="exercise-5"><strong>Exercise 5</strong></h3>
<p>You can now train the model. Set the number of epochs and observe the metrics returned at each iteration. You can also terminate the cell execution if you think your model is performing well already.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># OTHER THAN SETTING THE EPOCHS NUMBER, DO NOT CHANGE ANY OTHER CODE</span>

<span class="c1">### START CODE HERE ###</span>
<span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1">### END CODE HERE ###</span>

<span class="n">steps_per_epoch</span> <span class="o">=</span> <span class="mi">4000</span><span class="o">//</span><span class="n">BATCH_SIZE</span>
<span class="n">validation_steps</span> <span class="o">=</span> <span class="mi">800</span><span class="o">//</span><span class="n">BATCH_SIZE</span>
<span class="n">test_steps</span> <span class="o">=</span> <span class="mi">200</span><span class="o">//</span><span class="n">BATCH_SIZE</span>


<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training_dataset</span><span class="p">,</span>
                    <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">steps_per_epoch</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="n">validation_steps</span><span class="o">=</span><span class="n">validation_steps</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">EPOCHS</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output:</strong></p>
<p>The losses should generally be decreasing and the accuracies should generally be increasing. For example, observing the first 4 epochs should output something similar:</p>
<div class="highlight"><pre><span></span><code>Epoch 1/70
125/125 [==============================] - 6s 50ms/step - loss: 0.5542 - accuracy: 0.8635 - val_loss: 0.5335 - val_accuracy: 0.9427
Epoch 2/70
125/125 [==============================] - 6s 47ms/step - loss: 0.2315 - accuracy: 0.9425 - val_loss: 0.3362 - val_accuracy: 0.9427
Epoch 3/70
125/125 [==============================] - 6s 47ms/step - loss: 0.2118 - accuracy: 0.9426 - val_loss: 0.2592 - val_accuracy: 0.9427
Epoch 4/70
125/125 [==============================] - 6s 47ms/step - loss: 0.1782 - accuracy: 0.9431 - val_loss: 0.1770 - val_accuracy: 0.9432
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="model-evaluation">Model Evaluation</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="make-predictions">Make Predictions</h3>
<p>Let's get the predictions using our test dataset as input and print the shape.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">test_steps</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see, the resulting shape is <code>(192, 64, 84, 11)</code>. This means that for each of the 192 images that we have in our test set, there are 11 predictions generated (i.e. one for each class: 0 to 1 plus background).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Thus, if you want to see the <em>probability</em> of the upper leftmost pixel of the 1st image belonging to class 0, then you can print something like <code>results[0,0,0,0]</code>. If you want the probability of the same pixel at class 10, then do <code>results[0,0,0,10]</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What we're interested in is to get the <em>index</em> of the highest probability of each of these 11 slices and combine them in a single image. We can do that by getting the <a href="https://numpy.org/doc/stable/reference/generated/numpy.argmax.html">argmax</a> at this axis.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The new array generated per image now only specifies the indices of the class with the highest probability. Let's see the output class of the upper most left pixel. As you might have observed earlier when you inspected the dataset, the upper left corner is usually just part of the background (class 10). The actual digits are written somewhere in the middle parts of the image.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># prediction map for image 0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:])</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will use this <code>results</code> array when we evaluate our predictions.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="metrics">Metrics</h3>
<p>We showed in the lectures two ways to evaluate your predictions. The <em>intersection over union (IOU)</em> and the <em>dice score</em>. Recall that:</p>
<div class="arithmatex">\[IOU = \frac{area\_of\_overlap}{area\_of\_union}$$
&lt;br&gt;
$$Dice Score = 2 * \frac{area\_of\_overlap}{combined\_area}\]</div>
<p>The code below does that for you as you've also seen in the ungraded lab. A small smoothing factor is introduced in the denominators to prevent possible division by zero.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">class_wise_metrics</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Computes the class-wise IOU and Dice Score.</span>

<span class="sd">  Args:</span>
<span class="sd">    y_true (tensor) - ground truth label maps</span>
<span class="sd">    y_pred (tensor) - predicted label maps</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">class_wise_iou</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">class_wise_dice_score</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="n">smoothing_factor</span> <span class="o">=</span> <span class="mf">0.00001</span>

  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
    <span class="n">intersection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_true</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">y_true_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_true</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">y_pred_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>
    <span class="n">combined_area</span> <span class="o">=</span> <span class="n">y_true_area</span> <span class="o">+</span> <span class="n">y_pred_area</span>

    <span class="n">iou</span> <span class="o">=</span> <span class="p">(</span><span class="n">intersection</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">combined_area</span> <span class="o">-</span> <span class="n">intersection</span> <span class="o">+</span> <span class="n">smoothing_factor</span><span class="p">)</span>
    <span class="n">class_wise_iou</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iou</span><span class="p">)</span>

    <span class="n">dice_score</span> <span class="o">=</span>  <span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">intersection</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">combined_area</span> <span class="o">+</span> <span class="n">smoothing_factor</span><span class="p">))</span>
    <span class="n">class_wise_dice_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dice_score</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">class_wise_iou</span><span class="p">,</span> <span class="n">class_wise_dice_score</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="visualize-predictions">Visualize Predictions</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># place a number here between 0 to 191 to pick an image from the test set</span>
<span class="n">integer_slider</span> <span class="o">=</span> <span class="mi">105</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">unbatch</span><span class="p">()</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">y_true_segments</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
  <span class="n">y_true_segments</span> <span class="o">=</span> <span class="n">annotation</span>
  <span class="n">images</span> <span class="o">=</span> <span class="n">image</span>


<span class="n">iou</span><span class="p">,</span> <span class="n">dice_score</span> <span class="o">=</span> <span class="n">class_wise_metrics</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_true_segments</span><span class="p">[</span><span class="n">integer_slider</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">results</span><span class="p">[</span><span class="n">integer_slider</span><span class="p">])</span>  
<span class="n">show_annotation_and_prediction</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="n">integer_slider</span><span class="p">],</span> <span class="n">annotation</span><span class="p">[</span><span class="n">integer_slider</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="n">integer_slider</span><span class="p">],</span> <span class="n">iou</span><span class="p">,</span> <span class="n">dice_score</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="compute-iou-score-and-dice-score-of-your-model">Compute IOU Score and Dice Score of your model</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">cls_wise_iou</span><span class="p">,</span> <span class="n">cls_wise_dice_score</span> <span class="o">=</span> <span class="n">class_wise_metrics</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_true_segments</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">results</span><span class="p">)</span>

<span class="n">average_iou</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">iou</span><span class="p">,</span> <span class="n">dice_score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cls_wise_iou</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">cls_wise_dice_score</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Digit </span><span class="si">{}</span><span class="s2">: IOU: </span><span class="si">{}</span><span class="s2"> Dice Score: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">iou</span><span class="p">,</span> <span class="n">dice_score</span><span class="p">))</span> 
  <span class="n">average_iou</span> <span class="o">+=</span> <span class="n">iou</span>

<span class="n">grade</span> <span class="o">=</span> <span class="n">average_iou</span> <span class="o">*</span> <span class="mi">10</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Grade is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">grade</span><span class="p">))</span>

<span class="n">PASSING_GRADE</span> <span class="o">=</span> <span class="mi">60</span>
<span class="k">if</span> <span class="p">(</span><span class="n">grade</span><span class="o">&gt;</span><span class="n">PASSING_GRADE</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You passed!&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You failed. Please check your model and re-train&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="save-the-model">Save the Model</h2>
<p>Once you're satisfied with the results, you will need to save your model so you can upload it to the grader in the Coursera classroom. After running the cell below, please look for <code>student_model.h5</code> in the File Explorer on the left and download it. Then go back to the Coursera classroom and upload it to the Lab item that points to the autograder of Week 3.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># You can also use this cell as a shortcut for downloading your model</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>
<span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;model.h5&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Congratulations on completing this assignment on image segmentation!</strong></p>
</div>
</div>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/hari31416" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/hari31416" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/hari31416" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.kaggle.com/hari31416" target="_blank" rel="noopener" title="www.kaggle.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M304.2 501.5 158.4 320.3 298.2 185c2.6-2.7 1.7-10.5-5.3-10.5h-69.2c-3.5 0-7 1.8-10.5 5.3L80.9 313.5V7.5q0-7.5-7.5-7.5H21.5Q14 0 14 7.5v497q0 7.5 7.5 7.5h51.9q7.5 0 7.5-7.5v-109l30.8-29.3 110.5 140.6c3 3.5 6.5 5.3 10.5 5.3h66.9q5.25 0 6-3z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.instagram.com/hari31416" target="_blank" rel="noopener" title="www.instagram.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.top", "toc.integrate"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>