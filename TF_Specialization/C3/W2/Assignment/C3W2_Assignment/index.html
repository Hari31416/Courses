
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This is a collection of all the notebooks from various courses I have taken.">
      
      
        <meta name="author" content="Harikesh Kushwaha">
      
      
        <link rel="canonical" href="https://hari31416.github.io/Courses/TF_Specialization/C3/W2/Assignment/C3W2_Assignment/">
      
      
        <link rel="prev" href="../../../W1/Labs/C3_W1_Lab_3_Object_Localization/">
      
      
        <link rel="next" href="../../Labs/C3_W2_Lab_1_Simple_Object_Detection/">
      
      <link rel="icon" href="../../../../../assets/ml.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>C3W2 Assignment - Courses</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../../../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../../../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#week-2-assignment-zombie-detection" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Courses" class="md-header__button md-logo" aria-label="Courses" data-md-component="logo">
      
  <img src="../../../../../assets/ml.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Courses
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              C3W2 Assignment
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Hari31416/Courses" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Courses
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Courses" class="md-nav__button md-logo" aria-label="Courses" data-md-component="logo">
      
  <img src="../../../../../assets/ml.png" alt="logo">

    </a>
    Courses
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Hari31416/Courses" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Courses
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Deep Learning Specialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Deep Learning Specialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          C1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          C1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C1/Assignments/Building_your_Deep_Neural_Network_Step_by_Step/Building_your_Deep_Neural_Network_Step_by_Step/" class="md-nav__link">
        Building your Deep Neural Network Step by Step
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C1/Assignments/Deep_Neural_Network_-_Application/Deep_Neural_Network_-_Application/" class="md-nav__link">
        Deep Neural Network   Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C1/Assignments/Logistic_Regression_with_a_Neural_Network_mindset/Logistic_Regression_with_a_Neural_Network_mindset/" class="md-nav__link">
        Logistic Regression with a Neural Network mindset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C1/Assignments/Planar_data_classification_with_one_hidden_layer/Planar_data_classification_with_one_hidden_layer/" class="md-nav__link">
        Planar data classification with one hidden layer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          C2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          C2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Gradient_Checking/Gradient_Checking/" class="md-nav__link">
        Gradient Checking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Initialization/Initialization/" class="md-nav__link">
        Initialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Optimization_Methods/Optimization_methods/" class="md-nav__link">
        Optimization methods
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Regularization/Regularization/" class="md-nav__link">
        Regularization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C2/Assignments/Tensorflow_introduction/Tensorflow_introduction/" class="md-nav__link">
        Tensorflow introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          C4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          C4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Car_detection_with_YOLO/Autonomous_driving_application_Car_detection/" class="md-nav__link">
        Autonomous driving application Car detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Convolution_model_Application/Convolution_model_Application/" class="md-nav__link">
        Convolution model Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Image_segmentation_Unet/Image_segmentation_Unet_v2/" class="md-nav__link">
        Image segmentation Unet v2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Residual_Networks/Residual_Networks/" class="md-nav__link">
        Residual Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C4/Assignments/Transfer_learning_with_MobileNet/Transfer_learning_with_MobileNet_v1/" class="md-nav__link">
        Transfer learning with MobileNet v1
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
          C5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          C5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Building_a_Recurrent_Neural_Network_Step_by_Step/Building_a_Recurrent_Neural_Network_Step_by_Step/" class="md-nav__link">
        Building a Recurrent Neural Network Step by Step
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Dinosaurus_Island_Character_level_language_model/Dinosaurus_Island_Character_level_language_model/" class="md-nav__link">
        Dinosaurus Island Character level language model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Emojify/Emoji_v3a/" class="md-nav__link">
        Emoji v3a
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Improvise_a_Jazz_Solo_with_an_LSTM_Network/Improvise_a_Jazz_Solo_with_an_LSTM_Network_v4/" class="md-nav__link">
        Improvise a Jazz Solo with an LSTM Network v4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Neural_machine_translation_with_attention/Neural_machine_translation_with_attention_v4a/" class="md-nav__link">
        Neural machine translation with attention v4a
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLS/C5/Assignments/Operations_on_Word_Vectors_Debiasing/Operations_on_word_vectors_v2a/" class="md-nav__link">
        Operations on word vectors v2a
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Machine Learning Specialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Machine Learning Specialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          C1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          C1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/C1_W1_Lab03_Model_Representation_Soln/" class="md-nav__link">
        C1 W1 Lab03 Model Representation Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/C1_W1_Lab04_Cost_function_Soln/" class="md-nav__link">
        C1 W1 Lab04 Cost function Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/C1_W1_Lab05_Gradient_Descent_Soln/" class="md-nav__link">
        C1 W1 Lab05 Gradient Descent Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab01_Python_Jupyter_Soln/" class="md-nav__link">
        C1 W1 Lab01 Python Jupyter Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab02_Course_Preview_Soln/" class="md-nav__link">
        C1 W1 Lab02 Course Preview Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab03_Model_Representation_Soln/" class="md-nav__link">
        C1 W1 Lab03 Model Representation Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab04_Cost_function_Soln/" class="md-nav__link">
        C1 W1 Lab04 Cost function Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Assignments/Gradient_Descent/betaversion/C1_W1_Lab05_Gradient_Descent_Soln/" class="md-nav__link">
        C1 W1 Lab05 Gradient Descent Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Notes/Linear_Regression/" class="md-nav__link">
        Linear Regression
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W1/Notes/Overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab01_Python_Numpy_Vectorization_Soln/" class="md-nav__link">
        C1 W2 Lab01 Python Numpy Vectorization Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab02_Multiple_Variable_Soln/" class="md-nav__link">
        C1 W2 Lab02 Multiple Variable Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab03_Feature_Scaling_and_Learning_Rate_Soln/" class="md-nav__link">
        C1 W2 Lab03 Feature Scaling and Learning Rate Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab04_FeatEng_PolyReg_Soln/" class="md-nav__link">
        C1 W2 Lab04 FeatEng PolyReg Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab05_Sklearn_GD_Soln/" class="md-nav__link">
        C1 W2 Lab05 Sklearn GD Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/C1_W2_Lab06_Sklearn_Normal_Soln/" class="md-nav__link">
        C1 W2 Lab06 Sklearn Normal Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W2/Assignments/Linear_Regression/C1_W2_Linear_Regression/" class="md-nav__link">
        C1 W2 Linear Regression
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab01_Classification_Soln/" class="md-nav__link">
        C1 W3 Lab01 Classification Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab02_Sigmoid_function_Soln/" class="md-nav__link">
        C1 W3 Lab02 Sigmoid function Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab03_Decision_Boundary_Soln/" class="md-nav__link">
        C1 W3 Lab03 Decision Boundary Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab04_LogisticLoss_Soln/" class="md-nav__link">
        C1 W3 Lab04 LogisticLoss Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab05_Cost_Function_Soln/" class="md-nav__link">
        C1 W3 Lab05 Cost Function Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab07_Scikit_Learn_Soln/" class="md-nav__link">
        C1 W3 Lab07 Scikit Learn Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab08_Overfitting_Soln/" class="md-nav__link">
        C1 W3 Lab08 Overfitting Soln
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C1/W3/Assignments/C1_W3_Lab09_Regularization_Soln/" class="md-nav__link">
        C1 W3 Lab09 Regularization Soln
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          C2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          C2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W1/Assignment/C2_W1_Assignment/" class="md-nav__link">
        C2 W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W1/Lab/C2_W1_Lab01_Neurons_and_Layers/" class="md-nav__link">
        C2 W1 Lab01 Neurons and Layers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W1/Lab/C2_W1_Lab02_CoffeeRoasting_TF/" class="md-nav__link">
        C2 W1 Lab02 CoffeeRoasting TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W1/Lab/C2_W1_Lab03_CoffeeRoasting_Numpy/" class="md-nav__link">
        C2 W1 Lab03 CoffeeRoasting Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W2/Assignment/C2_W2_Assignment/" class="md-nav__link">
        C2 W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W2/Lab/C2_W2_Multiclass_TF/" class="md-nav__link">
        C2 W2 Multiclass TF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W2/Lab/C2_W2_Relu/" class="md-nav__link">
        C2 W2 Relu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W2/Lab/C2_W2_SoftMax/" class="md-nav__link">
        C2 W2 SoftMax
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W3/Assignment/C2_W3_Assignment/" class="md-nav__link">
        C2 W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C2/W4/Assignment/C2_W4_Decision_Tree_with_Markdown/" class="md-nav__link">
        C2 W4 Decision Tree with Markdown
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          C3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          C3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W1/Assignment/A1/C3_W1_KMeans_Assignment/" class="md-nav__link">
        C3 W1 KMeans Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W1/Assignment/A2/C3_W1_Anomaly_Detection/" class="md-nav__link">
        C3 W1 Anomaly Detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W2/Assignment/A1/C3_W2_Collaborative_RecSys_Assignment/" class="md-nav__link">
        C3 W2 Collaborative RecSys Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W2/Assignment/A2/C3_W2_RecSysNN_Assignment/" class="md-nav__link">
        C3 W2 RecSysNN Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W3/Assignment/C3_W3_A1_Assignment/" class="md-nav__link">
        C3 W3 A1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MLS/C3/W3/Lab/State-action%20value%20function%20example/" class="md-nav__link">
        State action value function example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          TensorFlow Advanced Techniques Specialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          TensorFlow Advanced Techniques Specialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          C1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          C1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W1/Labs/C1_W1_Lab_1_functional-practice/" class="md-nav__link">
        C1 W1 Lab 1 functional practice
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W1/Labs/C1_W1_Lab_2_multi-output/" class="md-nav__link">
        C1 W1 Lab 2 multi output
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W1/Labs/C1_W1_Lab_3_siamese-network/" class="md-nav__link">
        C1 W1 Lab 3 siamese network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W1/Multiple_Output_Models_using_the_Keras_Functional_API/C1W1_Assignment/" class="md-nav__link">
        C1W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W2/Creating_a_Custom_Loss_Function/C1W2_Assignment/" class="md-nav__link">
        C1W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W2/Labs/C1_W2_Lab_1_huber-loss/" class="md-nav__link">
        C1 W2 Lab 1 huber loss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W2/Labs/C1_W2_Lab_2_huber-object-loss/" class="md-nav__link">
        C1 W2 Lab 2 huber object loss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W3/Implement_a_Quadratic_Layer/C1W3_Assignment/" class="md-nav__link">
        C1W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W3/Labs/C1_W3_Lab_1_lambda-layer/" class="md-nav__link">
        C1 W3 Lab 1 lambda layer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W3/Labs/C1_W3_Lab_2_custom-dense-layer/" class="md-nav__link">
        C1 W3 Lab 2 custom dense layer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W3/Labs/C1_W3_Lab_3_custom-layer-activation/" class="md-nav__link">
        C1 W3 Lab 3 custom layer activation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W4/Create_a_VGG_network/C1W4_Assignment/" class="md-nav__link">
        C1W4 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W4/Labs/C1_W4_Lab_1_basic-model/" class="md-nav__link">
        C1 W4 Lab 1 basic model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C1/W4/Labs/C1_W4_Lab_2_resnet-example/" class="md-nav__link">
        C1 W4 Lab 2 resnet example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          C2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          C2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W1/Assignment/C2W1_Assignment/" class="md-nav__link">
        C2W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W1/Labs/C2_W1_Lab_1_basic-tensors/" class="md-nav__link">
        C2 W1 Lab 1 basic tensors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W1/Labs/C2_W1_Lab_2_gradient-tape-basics/" class="md-nav__link">
        C2 W1 Lab 2 gradient tape basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W2/Assignment/C2W2_Assignment/" class="md-nav__link">
        C2W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W2/Labs/C2_W2_Lab_1_training-basics/" class="md-nav__link">
        C2 W2 Lab 1 training basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W2/Labs/C2_W2_Lab_2_training-categorical/" class="md-nav__link">
        C2 W2 Lab 2 training categorical
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W3/Assignment/C2W3_Assignment/" class="md-nav__link">
        C2W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W3/Labs/C2_W3_Lab_1_autograph-basics/" class="md-nav__link">
        C2 W3 Lab 1 autograph basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W3/Labs/C2_W3_Lab_2-graphs-for-complex-code/" class="md-nav__link">
        C2 W3 Lab 2 graphs for complex code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Assignment/C2W4_Assignment/" class="md-nav__link">
        C2W4 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Labs/C2_W4_Lab_1_basic-mirrored-strategy/" class="md-nav__link">
        C2 W4 Lab 1 basic mirrored strategy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Labs/C2_W4_Lab_2_multi-GPU-mirrored-strategy/" class="md-nav__link">
        C2 W4 Lab 2 multi GPU mirrored strategy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Labs/C2_W4_Lab_3_using-TPU-strategy/" class="md-nav__link">
        C2 W4 Lab 3 using TPU strategy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C2/W4/Labs/C2_W4_Lab_4_one-device-strategy/" class="md-nav__link">
        C2 W4 Lab 4 one device strategy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          C3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          C3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W1/Assignment/C3W1_Assignment/" class="md-nav__link">
        C3W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W1/Labs/C3_W1_Lab_2_Transfer_Learning_CIFAR_10/" class="md-nav__link">
        C3 W1 Lab 2 Transfer Learning CIFAR 10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W1/Labs/C3_W1_Lab_3_Object_Localization/" class="md-nav__link">
        C3 W1 Lab 3 Object Localization
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          C3W2 Assignment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        C3W2 Assignment
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    Exercises
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    Imports
  </a>
  
    <nav class="md-nav" aria-label="Imports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-1-import-object-detection-api-packages" class="md-nav__link">
    Exercise 1: Import Object Detection API packages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    Utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-the-zombie-data" class="md-nav__link">
    Download the Zombie data
  </a>
  
    <nav class="md-nav" aria-label="Download the Zombie data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-2-visualize-the-training-images" class="md-nav__link">
    Exercise 2: Visualize the training images
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-data-for-training-optional" class="md-nav__link">
    Prepare data for training (Optional)
  </a>
  
    <nav class="md-nav" aria-label="Prepare data for training (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#option-1-draw-your-own-ground-truth-boxes" class="md-nav__link">
    Option 1: draw your own ground truth boxes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#option-2-use-the-given-ground-truth-boxes" class="md-nav__link">
    Option 2: use the given ground truth boxes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-your-ground-truth-box-coordinates" class="md-nav__link">
    View your ground truth box coordinates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-3-define-the-category-index-dictionary" class="md-nav__link">
    Exercise 3: Define the category index dictionary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-preprocessing" class="md-nav__link">
    Data preprocessing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualize-the-zombies-with-their-ground-truth-bounding-boxes" class="md-nav__link">
    Visualize the zombies with their ground truth bounding boxes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-the-checkpoint-containing-the-pre-trained-weights" class="md-nav__link">
    Download the checkpoint containing the pre-trained weights
  </a>
  
    <nav class="md-nav" aria-label="Download the checkpoint containing the pre-trained weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-4-download-checkpoints" class="md-nav__link">
    Exercise 4: Download checkpoints
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-model" class="md-nav__link">
    Configure the model
  </a>
  
    <nav class="md-nav" aria-label="Configure the model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-51-locate-and-read-from-the-configuration-file" class="md-nav__link">
    Exercise 5.1: Locate and read from the configuration file
  </a>
  
    <nav class="md-nav" aria-label="Exercise 5.1: Locate and read from the configuration file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipeline_config" class="md-nav__link">
    pipeline_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configs" class="md-nav__link">
    configs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-52-get-the-model-configuration" class="md-nav__link">
    Exercise 5.2: Get the model configuration
  </a>
  
    <nav class="md-nav" aria-label="Exercise 5.2: Get the model configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model_config" class="md-nav__link">
    model_config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-53-modify-model_config" class="md-nav__link">
    Exercise 5.3: Modify model_config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-model" class="md-nav__link">
    Build the model
  </a>
  
    <nav class="md-nav" aria-label="Build the model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-54-build-the-custom-model" class="md-nav__link">
    Exercise 5.4: Build the custom model
  </a>
  
    <nav class="md-nav" aria-label="Exercise 5.4: Build the custom model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model_builder" class="md-nav__link">
    model_builder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restore-weights-from-your-checkpoint" class="md-nav__link">
    Restore weights from your checkpoint
  </a>
  
    <nav class="md-nav" aria-label="Restore weights from your checkpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspect-the-detection_model" class="md-nav__link">
    Inspect the detection_model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#find-the-source-code-for-detection_model" class="md-nav__link">
    Find the source code for detection_model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-the-variables-in-detection_model" class="md-nav__link">
    View the variables in detection_model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-_feature_extractor" class="md-nav__link">
    Inspect _feature_extractor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-_box_predictor" class="md-nav__link">
    Inspect _box_predictor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-_box_predictor_1" class="md-nav__link">
    Inspect _box_predictor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-variables-in-_box_predictor" class="md-nav__link">
    View variables in _box_predictor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-base_tower_layers_for_heads" class="md-nav__link">
    Inspect base_tower_layers_for_heads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-_box_prediction_head" class="md-nav__link">
    Inspect _box_prediction_head
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-_prediction_heads" class="md-nav__link">
    Inspect _prediction_heads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#which-layers-will-you-reuse" class="md-nav__link">
    Which layers will you reuse?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#define-checkpoints-for-desired-layers" class="md-nav__link">
    Define checkpoints for desired layers
  </a>
  
    <nav class="md-nav" aria-label="Define checkpoints for desired layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-61-define-checkpoints-for-the-box-predictor" class="md-nav__link">
    Exercise 6.1: Define Checkpoints for the box predictor
  </a>
  
    <nav class="md-nav" aria-label="Exercise 6.1: Define Checkpoints for the box predictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expected-output" class="md-nav__link">
    Expected output
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-62-define-the-temporary-model-checkpoint" class="md-nav__link">
    Exercise 6.2: Define the temporary model checkpoint**
  </a>
  
    <nav class="md-nav" aria-label="Exercise 6.2: Define the temporary model checkpoint**">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#expected-output_1" class="md-nav__link">
    Expected output
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-63-restore-the-checkpoint" class="md-nav__link">
    Exercise 6.3: Restore the checkpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-7-run-a-dummy-image-to-generate-the-model-variables" class="md-nav__link">
    Exercise 7: Run a dummy image to generate the model variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eager-mode-custom-training-loop" class="md-nav__link">
    Eager mode custom training loop
  </a>
  
    <nav class="md-nav" aria-label="Eager mode custom training loop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-8-set-training-hyperparameters" class="md-nav__link">
    Exercise 8: Set training hyperparameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choose-the-layers-to-fine-tune" class="md-nav__link">
    Choose the layers to fine-tune
  </a>
  
    <nav class="md-nav" aria-label="Choose the layers to fine-tune">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-9-select-the-prediction-layer-variables" class="md-nav__link">
    Exercise 9: Select the prediction layer variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#train-your-model" class="md-nav__link">
    Train your model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-a-prediction" class="md-nav__link">
    Make a prediction
  </a>
  
    <nav class="md-nav" aria-label="Make a prediction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calculate-loss" class="md-nav__link">
    Calculate loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#provide-the-ground-truth" class="md-nav__link">
    Provide the ground truth
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-10-define-the-training-step" class="md-nav__link">
    Exercise 10: Define the training step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-training-loop" class="md-nav__link">
    Run the training loop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-test-images-and-run-inference-with-new-model" class="md-nav__link">
    Load test images and run inference with new model!
  </a>
  
    <nav class="md-nav" aria-label="Load test images and run inference with new model!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-11-preprocess-predict-and-post-process-an-image" class="md-nav__link">
    Exercise 11: Preprocess, predict, and post process an image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-zip-of-the-zombie-walk-images" class="md-nav__link">
    Create a zip of the zombie-walk images.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-zombie-animation" class="md-nav__link">
    Create Zombie animation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-results-file-for-grading" class="md-nav__link">
    Save results file for grading
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/C3_W2_Lab_1_Simple_Object_Detection/" class="md-nav__link">
        C3 W2 Lab 1 Simple Object Detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/Object_Detection_Inference_on_TF_2_and_TF_Hub/" class="md-nav__link">
        Object Detection Inference on TF 2 and TF Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W3/Assignment/C3W3_Assignment/" class="md-nav__link">
        C3W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W3/Labs/C3_W3_Lab_1_VGG16_FCN8_CamVid/" class="md-nav__link">
        C3 W3 Lab 1 VGG16 FCN8 CamVid
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W3/Labs/C3_W3_Lab_2_OxfordPets_UNet/" class="md-nav__link">
        C3 W3 Lab 2 OxfordPets UNet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W3/Labs/C3_W3_Lab_3_Mask_RCNN_ImageSegmentation/" class="md-nav__link">
        C3 W3 Lab 3 Mask RCNN ImageSegmentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W4/Assignment/C3_W4_Assignment/" class="md-nav__link">
        C3 W4 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W4/Labs/C3_W4_Lab_1_FashionMNIST_CAM/" class="md-nav__link">
        C3 W4 Lab 1 FashionMNIST CAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W4/Labs/C3_W4_Lab_2_CatsDogs_CAM/" class="md-nav__link">
        C3 W4 Lab 2 CatsDogs CAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../W4/Labs/C3_W4_Lab_3_Saliency/" class="md-nav__link">
        C3 W4 Lab 3 Saliency
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          C4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          C4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W1/Assignment/C4W1_Assignment/" class="md-nav__link">
        C4W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W1/Labs/C4_W1_Lab_1_Neural_Style_Transfer/" class="md-nav__link">
        C4 W1 Lab 1 Neural Style Transfer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W1/Labs/C4_W1_Lab_2_Fast_NST/" class="md-nav__link">
        C4 W1 Lab 2 Fast NST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Assignment/C4W2_Assignment/" class="md-nav__link">
        C4W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_1_FirstAutoEncoder/" class="md-nav__link">
        C4 W2 Lab 1 FirstAutoEncoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_2_MNIST_Autoencoder/" class="md-nav__link">
        C4 W2 Lab 2 MNIST Autoencoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_3_MNIST_DeepAutoencoder/" class="md-nav__link">
        C4 W2 Lab 3 MNIST DeepAutoencoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_4_FashionMNIST_CNNAutoEncoder/" class="md-nav__link">
        C4 W2 Lab 4 FashionMNIST CNNAutoEncoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W2/Labs/C4_W2_Lab_5_FashionMNIST_NoisyCNNAutoEncoder/" class="md-nav__link">
        C4 W2 Lab 5 FashionMNIST NoisyCNNAutoEncoder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W3/Assignment/C4W3_Assignment/" class="md-nav__link">
        C4W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W3/Labs/C4_W3_Lab_1_VAE_MNIST/" class="md-nav__link">
        C4 W3 Lab 1 VAE MNIST
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W4/Assignment/C4W4_Assignment/" class="md-nav__link">
        C4W4 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W4/Labs/C4_W4_Lab_1_First_GAN/" class="md-nav__link">
        C4 W4 Lab 1 First GAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W4/Labs/C4_W4_Lab_2_First_DCGAN/" class="md-nav__link">
        C4 W4 Lab 2 First DCGAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../C4/W4/Labs/C4_W4_Lab_3_CelebA_GAN_Experiments/" class="md-nav__link">
        C4 W4 Lab 3 CelebA GAN Experiments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Generative Adversarial Networks Specialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Generative Adversarial Networks Specialization
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
      
      
      
        <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
          C1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          C1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W1/Assignments/C1W1_Your_First_GAN/" class="md-nav__link">
        C1W1 Your First GAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W1/Labs/Intro_to_PyTorch/" class="md-nav__link">
        Intro to PyTorch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W2/Assignments/C1_W2_Assignment/" class="md-nav__link">
        C1 W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W2/Labs/C1W2_Video_Generation_%28Optional%29/" class="md-nav__link">
        C1W2 Video Generation (Optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W3/Assignments/C1W3_WGAN_GP/" class="md-nav__link">
        C1W3 WGAN GP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W3/Labs/SNGAN/" class="md-nav__link">
        SNGAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W4/Assignments/C1W4A_Build_a_Conditional_GAN/" class="md-nav__link">
        C1W4A Build a Conditional GAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C1/W4/Assignments/C1W4B_Controllable_Generation/" class="md-nav__link">
        C1W4B Controllable Generation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          C2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          C2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W1/Assignments/C2W1_Assignment/" class="md-nav__link">
        C2W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W1/Labs/PPL/" class="md-nav__link">
        PPL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W2/Assignments/C2W2_Assignment/" class="md-nav__link">
        C2W2 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W2/Labs/C2W2_VAE/" class="md-nav__link">
        C2W2 VAE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W3/Assignments/C2W3_Assignment/" class="md-nav__link">
        C2W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W3/Labs/BigGAN/" class="md-nav__link">
        BigGAN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C2/W3/Labs/StyleGAN2/" class="md-nav__link">
        StyleGAN2
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
          C3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          C3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W1/Assignments/C3W1_Assignment/" class="md-nav__link">
        C3W1 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W1/Labs/C3W1_Generative_Teaching_Networks_%28Optional%29/" class="md-nav__link">
        C3W1 Generative Teaching Networks (Optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W2/Assignments/C3W2A_Assignment/" class="md-nav__link">
        C3W2A Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W2/Assignments/C3W2B_Assignment/" class="md-nav__link">
        C3W2B Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W2/Labs/C3W2_GauGAN_%28Optional%29/" class="md-nav__link">
        C3W2 GauGAN (Optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W2/Labs/C3W2_Pix2PixHD_%28Optional%29/" class="md-nav__link">
        C3W2 Pix2PixHD (Optional)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W3/Assignments/C3W3_Assignment/" class="md-nav__link">
        C3W3 Assignment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../GAN/C3/W3/Labs/C3W3_MUNIT_%28Optional%29/" class="md-nav__link">
        C3W3 MUNIT (Optional)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Deep Learning AI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Deep Learning AI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          Diffusion
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Diffusion
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Diffusion/Lab1/L1_Sampling/" class="md-nav__link">
        L1 Sampling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Diffusion/Lab2/L2_Training/" class="md-nav__link">
        L2 Training
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Diffusion/Lab3/L3_Context/" class="md-nav__link">
        L3 Context
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Diffusion/Lab4/L4_FastSampling/" class="md-nav__link">
        L4 FastSampling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          Prompt
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Prompt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l2-guidelines/" class="md-nav__link">
        L2 guidelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l4-summarizing/" class="md-nav__link">
        L4 summarizing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l5-inferring/" class="md-nav__link">
        L5 inferring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l6-transforming/" class="md-nav__link">
        L6 transforming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l7-expanding/" class="md-nav__link">
        L7 expanding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../DLAI/Prompt/l8-chatbot/" class="md-nav__link">
        L8 chatbot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="week-2-assignment-zombie-detection">Week 2 Assignment: Zombie Detection</h1>
<p>Welcome to this week's programming assignment! You will use the Object Detection API and retrain <a href="https://arxiv.org/abs/1708.02002">RetinaNet</a> to spot Zombies using just 5 training images. You will setup the model to restore pretrained weights and fine tune the classification layers.</p>
<p><strong><em>Important:</em></strong> <em>This colab notebook has read-only access so you won't be able to save your changes. If you want to save your work periodically, please click <code>File -&gt; Save a Copy in Drive</code> to create a copy in your account, then work from there.</em>  </p>
<p><img src='https://drive.google.com/uc?export=view&id=18Ck0qNSZy9F1KsUKWc4Jv7_x_1e_fXTN' alt='zombie'></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="exercises">Exercises</h2>
<ul>
<li><a href="#exercise-1">Exercise 1 - Import Object Detection API packages</a></li>
<li><a href="#exercise-2">Exercise 2 - Visualize the training images</a></li>
<li><a href="#exercise-3">Exercise 3 - Define the category index dictionary</a></li>
<li><a href="#exercise-4">Exercise 4 - Download checkpoints</a></li>
<li><a href="#exercise-5-1">Exercise 5.1 - Locate and read from the configuration file</a></li>
<li><a href="#exercise-5-2">Exercise 5.2 - Modify the model configuration</a></li>
<li><a href="#exercise-5-3">Exercise 5.3 - Modify model_config</a></li>
<li><a href="#exercise-5-4">Exercise 5.4 - Build the custom model</a></li>
<li><a href="#exercise-6-1">Exercise 6.1 - Define Checkpoints for the box predictor</a></li>
<li><a href="#exercise-6-2">Exercise 6.2 - Define the temporary model checkpoint</a></li>
<li><a href="#exercise-6-2">Exercise 6.3 - Restore the checkpoint</a></li>
<li><a href="#exercise-7">Exercise 7 - Run a dummy image to generate the model variables</a></li>
<li><a href="#exercise-8">Exercise 8 - Set training hyperparameters</a></li>
<li><a href="#exercise-9">Exercise 9 - Select the prediction layer variables</a></li>
<li><a href="#exercise-10">Exercise 10 - Define the training step</a></li>
<li><a href="#exercise-11">Exercise 11 - Preprocess, predict, and post process an image</a></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="installation">Installation</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You'll start by installing the Tensorflow 2 <a href="https://github.com/tensorflow/models/tree/master/research/object_detection">Object Detection API</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># uncomment the next line if you want to delete an existing models directory</span>
<span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">./</span><span class="n">models</span><span class="o">/</span>

<span class="c1"># clone the Tensorflow Model Garden</span>
<span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">depth</span> <span class="mi">1</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">/</span><span class="n">models</span><span class="o">/</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Compile the Object Detection API protocol buffers</span>
<span class="err">!</span><span class="n">cd</span> <span class="n">models</span><span class="o">/</span><span class="n">research</span><span class="o">/</span> <span class="o">&amp;&amp;</span> <span class="n">protoc</span> <span class="n">object_detection</span><span class="o">/</span><span class="n">protos</span><span class="o">/*.</span><span class="n">proto</span> <span class="o">--</span><span class="n">python_out</span><span class="o">=.</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You will write a file based on the <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/packages/tf2/setup.py">setup script</a> in the official repo to work with the packages in the current version of Colab. We removed some the packages that is not needed in this lab to make the installation faster.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">writefile</span> <span class="n">models</span><span class="o">/</span><span class="n">research</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">py</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">find_packages</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">REQUIRED_PACKAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;tf-models-official==2.8.0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tensorflow_io&#39;</span>
<span class="p">]</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;object_detection&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.1&#39;</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="n">REQUIRED_PACKAGES</span><span class="p">,</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">(</span>
        <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">find_packages</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;object_detection&#39;</span><span class="p">)]</span> <span class="o">+</span>
        <span class="n">find_packages</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;slim&#39;</span><span class="p">))),</span>
    <span class="n">package_dir</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;datasets&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;slim&#39;</span><span class="p">,</span> <span class="s1">&#39;datasets&#39;</span><span class="p">),</span>
        <span class="s1">&#39;nets&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;slim&#39;</span><span class="p">,</span> <span class="s1">&#39;nets&#39;</span><span class="p">),</span>
        <span class="s1">&#39;preprocessing&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;slim&#39;</span><span class="p">,</span> <span class="s1">&#39;preprocessing&#39;</span><span class="p">),</span>
        <span class="s1">&#39;deployment&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;slim&#39;</span><span class="p">,</span> <span class="s1">&#39;deployment&#39;</span><span class="p">),</span>
        <span class="s1">&#39;scripts&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;slim&#39;</span><span class="p">,</span> <span class="s1">&#39;scripts&#39;</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Tensorflow Object Detection Library&#39;</span><span class="p">,</span>
    <span class="n">python_requires</span><span class="o">=</span><span class="s1">&#39;&gt;3.6&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Run the setup script you just wrote</span>
<span class="err">!</span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">models</span><span class="o">/</span><span class="n">research</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="imports">Imports</h2>
<p>Let's now import the packages you will use in this assignment.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">scipy.misc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">imageio</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageFont</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Javascript</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">IPyImage</span>

<span class="k">try</span><span class="p">:</span>
  <span class="c1"># %tensorflow_version only exists in Colab.</span>
  <span class="o">%</span><span class="n">tensorflow_version</span> <span class="mf">2.</span><span class="n">x</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
  <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-1'></a></p>
<h3 id="exercise-1-import-object-detection-api-packages"><strong>Exercise 1</strong>: Import Object Detection API packages</h3>
<p>Import the necessary modules from the <code>object_detection</code> package. 
- From the <a href="https://github.com/tensorflow/models/tree/master/research/object_detection/utils">utils</a> package:
  - <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/utils/label_map_util.py">label_map_util</a>
  - <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/utils/config_util.py">config_util</a>: You'll use this to read model configurations from a .config file and then modify that configuration
  - <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/utils/visualization_utils.py">visualization_utils</a>: please give this the alias <code>viz_utils</code>, as this is what will be used in some visualization code that is given to you later.
  - <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/utils/colab_utils.py">colab_utils</a>
- From the <a href="https://github.com/tensorflow/models/tree/master/research/object_detection/builders">builders</a> package:
  - <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/builders/model_builder.py">model_builder</a>: This builds your model according to the model configuration that you'll specify.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE (Replace Instances of `None` with your code) ###</span>
<span class="c1"># import the label map utility module</span>
<span class="kn">from</span> <span class="nn">object_detection.utils</span> <span class="kn">import</span> <span class="n">label_map_util</span>

<span class="c1"># import module for reading and updating configuration files.</span>
<span class="kn">from</span> <span class="nn">object_detection.utils</span> <span class="kn">import</span> <span class="n">config_util</span>

<span class="c1"># import module for visualization. use the alias `viz_utils`</span>
<span class="kn">from</span> <span class="nn">object_detection.utils</span> <span class="kn">import</span> <span class="n">visualization_utils</span> <span class="k">as</span> <span class="n">viz_utils</span>

<span class="c1"># import module for building the detection model</span>
<span class="kn">from</span> <span class="nn">object_detection.builders</span> <span class="kn">import</span> <span class="n">model_builder</span>
<span class="c1">### END CODE HERE ###</span>

<span class="c1"># import module for utilities in Colab</span>
<span class="kn">from</span> <span class="nn">object_detection.utils</span> <span class="kn">import</span> <span class="n">colab_utils</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="utilities">Utilities</h2>
<p>You'll define a couple of utility functions for loading images and plotting detections. This code is provided for you.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_image_into_numpy_array</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load an image from file into a numpy array.</span>

<span class="sd">    Puts image into numpy array to feed into tensorflow graph.</span>
<span class="sd">    Note that by convention we put it into a numpy array with shape</span>
<span class="sd">    (height, width, channels), where channels=3 for RGB.</span>

<span class="sd">    Args:</span>
<span class="sd">    path: a file path.</span>

<span class="sd">    Returns:</span>
<span class="sd">    uint8 numpy array with shape (img_height, img_width, 3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">img_data</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">gfile</span><span class="o">.</span><span class="n">GFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">img_data</span><span class="p">))</span>
    <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">)</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getdata</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
        <span class="p">(</span><span class="n">im_height</span><span class="p">,</span> <span class="n">im_width</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_detections</span><span class="p">(</span><span class="n">image_np</span><span class="p">,</span>
                    <span class="n">boxes</span><span class="p">,</span>
                    <span class="n">classes</span><span class="p">,</span>
                    <span class="n">scores</span><span class="p">,</span>
                    <span class="n">category_index</span><span class="p">,</span>
                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
                    <span class="n">image_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper function to visualize detections.</span>

<span class="sd">    Args:</span>
<span class="sd">    image_np: uint8 numpy array with shape (img_height, img_width, 3)</span>
<span class="sd">    boxes: a numpy array of shape [N, 4]</span>
<span class="sd">    classes: a numpy array of shape [N]. Note that class indices are 1-based,</span>
<span class="sd">          and match the keys in the label map.</span>
<span class="sd">    scores: a numpy array of shape [N] or None.  If scores=None, then</span>
<span class="sd">          this function assumes that the boxes to be plotted are groundtruth</span>
<span class="sd">          boxes and plot all boxes as black with no classes or scores.</span>
<span class="sd">    category_index: a dict containing category dictionaries (each holding</span>
<span class="sd">          category index `id` and category name `name`) keyed by category indices.</span>
<span class="sd">    figsize: size for the figure.</span>
<span class="sd">    image_name: a name for the image file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">image_np_with_annotations</span> <span class="o">=</span> <span class="n">image_np</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">viz_utils</span><span class="o">.</span><span class="n">visualize_boxes_and_labels_on_image_array</span><span class="p">(</span>
        <span class="n">image_np_with_annotations</span><span class="p">,</span>
        <span class="n">boxes</span><span class="p">,</span>
        <span class="n">classes</span><span class="p">,</span>
        <span class="n">scores</span><span class="p">,</span>
        <span class="n">category_index</span><span class="p">,</span>
        <span class="n">use_normalized_coordinates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">min_score_thresh</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">image_name</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">image_name</span><span class="p">,</span> <span class="n">image_np_with_annotations</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_np_with_annotations</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="download-the-zombie-data">Download the Zombie data</h2>
<p>Now you will get 5 images of zombies that you will use for training. 
- The zombies are hosted in a Google bucket.
- You can download and unzip the images into a local <code>training/</code> directory by running the cell below.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># uncomment the next 2 lines if you want to delete an existing zip and training directory</span>
<span class="c1"># !rm training-zombie.zip</span>
<span class="c1"># !rm -rf ./training</span>

<span class="c1"># download the images</span>
<span class="err">!</span><span class="n">wget</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">check</span><span class="o">-</span><span class="n">certificate</span> \
    <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">public</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">training</span><span class="o">-</span><span class="n">zombie</span><span class="o">.</span><span class="n">zip</span> \
    <span class="o">-</span><span class="n">O</span> <span class="o">./</span><span class="n">training</span><span class="o">-</span><span class="n">zombie</span><span class="o">.</span><span class="n">zip</span>

<span class="c1"># unzip to a local directory</span>
<span class="n">local_zip</span> <span class="o">=</span> <span class="s1">&#39;./training-zombie.zip&#39;</span>
<span class="n">zip_ref</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">local_zip</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;./training&#39;</span><span class="p">)</span>
<span class="n">zip_ref</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-2'></a></p>
<h3 id="exercise-2-visualize-the-training-images"><strong>Exercise 2</strong>: Visualize the training images</h3>
<p>Next, you'll want to inspect the images that you just downloaded. </p>
<ul>
<li>Please replace instances of <code>None</code> below to load and visualize the 5 training images. </li>
<li>You can inspect the <em>training</em> directory (using the <code>Files</code> button on the left side of this Colab) to see the filenames of the zombie images. The paths for the images will look like this:</li>
</ul>
<p><div class="highlight"><pre><span></span><code>./training/training-zombie1.jpg
./training/training-zombie2.jpg
./training/training-zombie3.jpg
./training/training-zombie4.jpg
./training/training-zombie5.jpg
</code></pre></div>
- To set file paths, you'll use <a href="https://www.geeksforgeeks.org/python-os-path-join-method/">os.path.join</a>.  As an example, if you wanted to create the path './parent_folder/file_name1.txt', you could write: </p>
<p><code>os.path.join('parent_folder', 'file_name' + str(1) + '.txt')</code></p>
<ul>
<li>You should see the 5 training images after running this cell. If not, please inspect your code, particularly the <code>image_path</code>.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1">### START CODE HERE (Replace Instances of `None` with your code) ###</span>

<span class="c1"># assign the name (string) of the directory containing the training images</span>
<span class="n">train_image_dir</span> <span class="o">=</span> <span class="s1">&#39;training&#39;</span>

<span class="c1"># declare an empty list</span>
<span class="n">train_images_np</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># run a for loop for each image</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>

    <span class="c1"># define the path (string) for each image</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train_image_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;training-zombie</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s1">.jpg&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

    <span class="c1"># load images into numpy arrays and append to a list</span>
    <span class="n">train_images_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">load_image_into_numpy_array</span><span class="p">(</span><span class="n">image_path</span><span class="p">))</span>
<span class="c1">### END CODE HERE ###</span>

<span class="c1"># configure plot settings via rcParams</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>

<span class="c1"># plot images</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">train_image_np</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_images_np</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">train_image_np</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='gt_boxes_definition'></a></p>
<h2 id="prepare-data-for-training-optional">Prepare data for training (Optional)</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this section, you will create your ground truth boxes. You can either draw your own boxes or use a prepopulated list of coordinates that we have provided below. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Define the list of ground truth boxes</span>
<span class="n">gt_boxes</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="option-1-draw-your-own-ground-truth-boxes">Option 1: draw your own ground truth boxes</h4>
<p>If you want to draw your own, please run the next cell and the following test code. If not, then skip these optional cells.</p>
<ul>
<li>Draw a box around the zombie in each image. </li>
<li>Click the <code>next image</code> button to go to the next image</li>
<li>
<p>Click <code>submit</code> when it says "All images completed!!". </p>
</li>
<li>
<p>Make sure to not make the bounding box too big. </p>
</li>
<li>If the box is too big, the model might learn the features of the background (e.g. door, road, etc) in determining if there is a zombie or not. </li>
<li>Include the entire zombie inside the box. </li>
<li>As an example, scroll to the beginning of this notebook to look at the bounding box around the zombie.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Option 1: draw your own ground truth boxes</span>

<span class="c1"># annotate the training images</span>
<span class="n">colab_utils</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">train_images_np</span><span class="p">,</span> <span class="n">box_storage_pointer</span><span class="o">=</span><span class="n">gt_boxes</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Option 1: draw your own ground truth boxes</span>
<span class="c1"># TEST CODE:</span>
<span class="k">try</span><span class="p">:</span>
  <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gt_boxes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">),</span> <span class="s2">&quot;Warning: gt_boxes is empty. Did you click `submit`?&quot;</span>

<span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

<span class="c1"># checks if there are boxes for all 5 images</span>
<span class="k">for</span> <span class="n">gt_box</span> <span class="ow">in</span> <span class="n">gt_boxes</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">gt_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;There are less than 5 sets of box coordinates. &quot;</span> \
                                  <span class="s2">&quot;Please re-run the cell above to draw the boxes again.</span><span class="se">\n</span><span class="s2">&quot;</span> \
                                  <span class="s2">&quot;Alternatively, you can run the next cell to load pre-determined &quot;</span> \
                                  <span class="s2">&quot;ground truth boxes.&quot;</span>

    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">break</span>


<span class="n">ref_gt_boxes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.27333333</span><span class="p">,</span> <span class="mf">0.41500586</span><span class="p">,</span> <span class="mf">0.74333333</span><span class="p">,</span> <span class="mf">0.57678781</span><span class="p">]]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.29833333</span><span class="p">,</span> <span class="mf">0.45955451</span><span class="p">,</span> <span class="mf">0.75666667</span><span class="p">,</span> <span class="mf">0.61078546</span><span class="p">]]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.40833333</span><span class="p">,</span> <span class="mf">0.18288394</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">,</span> <span class="mf">0.34818288</span><span class="p">]]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.16166667</span><span class="p">,</span> <span class="mf">0.61899179</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.91910903</span><span class="p">]]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.28833333</span><span class="p">,</span> <span class="mf">0.12543962</span><span class="p">,</span> <span class="mf">0.835</span><span class="p">,</span> <span class="mf">0.35052755</span><span class="p">]]),</span>
      <span class="p">]</span>

<span class="k">for</span> <span class="n">gt_box</span><span class="p">,</span> <span class="n">ref_gt_box</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gt_boxes</span><span class="p">,</span> <span class="n">ref_gt_boxes</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">gt_box</span><span class="p">,</span> <span class="n">ref_gt_box</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)),</span> <span class="s2">&quot;One of the boxes is too big or too small. &quot;</span> \
                                                          <span class="s2">&quot;Please re-draw and make the box tighter around the zombie.&quot;</span>

    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
      <span class="k">break</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='gt-boxes'></a></p>
<h4 id="option-2-use-the-given-ground-truth-boxes">Option 2: use the given ground truth boxes</h4>
<p>You can also use this list if you opt not to draw the boxes yourself.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Option 2: use given ground truth boxes</span>
<span class="c1"># set this to `True` if you want to override the boxes you drew</span>
<span class="n">override</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># bounding boxes for each of the 5 zombies found in each image. </span>
<span class="c1"># you can use these instead of drawing the boxes yourself.</span>
<span class="n">ref_gt_boxes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.27333333</span><span class="p">,</span> <span class="mf">0.41500586</span><span class="p">,</span> <span class="mf">0.74333333</span><span class="p">,</span> <span class="mf">0.57678781</span><span class="p">]]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.29833333</span><span class="p">,</span> <span class="mf">0.45955451</span><span class="p">,</span> <span class="mf">0.75666667</span><span class="p">,</span> <span class="mf">0.61078546</span><span class="p">]]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.40833333</span><span class="p">,</span> <span class="mf">0.18288394</span><span class="p">,</span> <span class="mf">0.945</span><span class="p">,</span> <span class="mf">0.34818288</span><span class="p">]]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.16166667</span><span class="p">,</span> <span class="mf">0.61899179</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.91910903</span><span class="p">]]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.28833333</span><span class="p">,</span> <span class="mf">0.12543962</span><span class="p">,</span> <span class="mf">0.835</span><span class="p">,</span> <span class="mf">0.35052755</span><span class="p">]]),</span>
      <span class="p">]</span>

<span class="c1"># if gt_boxes is empty, use the reference</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">gt_boxes</span> <span class="ow">or</span> <span class="n">override</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
  <span class="n">gt_boxes</span> <span class="o">=</span> <span class="n">ref_gt_boxes</span>

<span class="c1"># if gt_boxes does not contain 5 box coordinates, use the reference </span>
<span class="k">for</span> <span class="n">gt_box</span> <span class="ow">in</span> <span class="n">gt_boxes</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">assert</span><span class="p">(</span><span class="n">gt_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">except</span><span class="p">:</span>
      <span class="n">gt_boxes</span> <span class="o">=</span> <span class="n">ref_gt_boxes</span>

      <span class="k">break</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="view-your-ground-truth-box-coordinates">View your ground truth box coordinates</h4>
<p>Whether you chose to draw your own or use the given boxes, please check your list of ground truth box coordinates.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># print the coordinates of your ground truth boxes</span>
<span class="k">for</span> <span class="n">gt_box</span> <span class="ow">in</span> <span class="n">gt_boxes</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">gt_box</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Below, we add the class annotations. For simplicity, we assume just a single class, though it should be straightforward to extend this to handle multiple classes. We will also convert everything to the format that the training loop expects (e.g., conversion to tensors, one-hot representations, etc.).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-3'></a></p>
<h3 id="exercise-3-define-the-category-index-dictionary"><strong>Exercise 3</strong>: Define the category index dictionary</h3>
<p>You'll need to tell the model which integer class ID to assign to the 'zombie' category, and what 'name' to associate with that integer id.</p>
<ul>
<li>zombie_class_id: By convention, class ID integers start numbering from 1,2,3, onward.</li>
<li>If there is ever a 'background' class, it could be assigned the integer 0, but in this case, you're just predicting the one zombie class.</li>
<li>
<p>Since you are just predicting one class (zombie), please assign <code>1</code> to the zombie class ID.</p>
</li>
<li>
<p>category_index: Please define the <code>category_index</code> dictionary, which will have the same structure as this:
<div class="highlight"><pre><span></span><code>{human_class_id : 
  {&#39;id&#39;  : human_class_id, 
   &#39;name&#39;: &#39;human_so_far&#39;}
}
</code></pre></div></p>
</li>
<li>Define <code>category_index</code> similar to the example dictionary above, except for zombies.</li>
<li>
<p>This will be used by the succeeding functions to know the class <code>id</code> and <code>name</code> of zombie images.</p>
</li>
<li>
<p>num_classes: Since you are predicting one class, please assign <code>1</code> to the number of classes that the model will predict.</p>
</li>
<li>This will be used during data preprocessing and again when you configure the model.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE (Replace instances of `None` with your code ###</span>

<span class="c1"># Assign the zombie class ID</span>
<span class="n">zombie_class_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># define a dictionary describing the zombie class</span>
<span class="n">category_index</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">zombie_class_id</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">zombie_class_id</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;zombie&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1"># Specify the number of classes that the model will predict</span>
<span class="n">num_classes</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1">### END CODE HERE ###</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># TEST CODE:</span>

<span class="nb">print</span><span class="p">(</span><span class="n">category_index</span><span class="p">[</span><span class="n">zombie_class_id</span><span class="p">])</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output:</strong></p>
<div class="highlight"><pre><span></span><code>{&#39;id&#39;: 1, &#39;name&#39;: &#39;zombie&#39;}
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="data-preprocessing">Data preprocessing</h3>
<p>You will now do some data preprocessing so it is formatted properly before it is fed to the model:
- Convert the class labels to one-hot representations
- convert everything (i.e. train images, gt boxes and class labels) to tensors.</p>
<p>This code is provided for you.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># The `label_id_offset` here shifts all classes by a certain number of indices;</span>
<span class="c1"># we do this here so that the model receives one-hot labels where non-background</span>
<span class="c1"># classes start counting at the zeroth index.  This is ordinarily just handled</span>
<span class="c1"># automatically in our training binaries, but we need to reproduce it here.</span>

<span class="n">label_id_offset</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">train_image_tensors</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># lists containing the one-hot encoded classes and ground truth boxes</span>
<span class="n">gt_classes_one_hot_tensors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gt_box_tensors</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="p">(</span><span class="n">train_image_np</span><span class="p">,</span> <span class="n">gt_box_np</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">train_images_np</span><span class="p">,</span> <span class="n">gt_boxes</span><span class="p">):</span>

    <span class="c1"># convert training image to tensor, add batch dimension, and add to list</span>
    <span class="n">train_image_tensors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span>
        <span class="n">train_image_np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="c1"># convert numpy array to tensor, then add to list</span>
    <span class="n">gt_box_tensors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">gt_box_np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

    <span class="c1"># apply offset to to have zero-indexed ground truth classes</span>
    <span class="n">zero_indexed_groundtruth_classes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="n">gt_box_np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">-</span> <span class="n">label_id_offset</span><span class="p">)</span>

    <span class="c1"># do one-hot encoding to ground truth classes</span>
    <span class="n">gt_classes_one_hot_tensors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span>
        <span class="n">zero_indexed_groundtruth_classes</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done prepping data.&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="visualize-the-zombies-with-their-ground-truth-bounding-boxes">Visualize the zombies with their ground truth bounding boxes</h2>
<p>You should see the 5 training images with the bounding boxes after running the cell below. If not, please re-run the <a href="#gt_boxes_definition">annotation tool</a> again or use the prepopulated <code>gt_boxes</code> array given.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># give boxes a score of 100%</span>
<span class="n">dummy_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># define the figure size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>

<span class="c1"># use the `plot_detections()` utility function to draw the ground truth boxes</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plot_detections</span><span class="p">(</span>
      <span class="n">train_images_np</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
      <span class="n">gt_boxes</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
      <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="n">gt_boxes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
      <span class="n">dummy_scores</span><span class="p">,</span> <span class="n">category_index</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="download-the-checkpoint-containing-the-pre-trained-weights">Download the checkpoint containing the pre-trained weights</h2>
<p>Next, you will download <a href="https://arxiv.org/abs/1708.02002">RetinaNet</a> and copy it inside the object detection directory.</p>
<p>When working with models that are at the frontiers of research, the models and checkpoints may not yet be organized in a central location like the TensorFlow Garden (https://github.com/tensorflow/models).
- You'll often read a blog post from the researchers, who will usually provide information on:
  - how to use the model
  - where to download the models and pre-trained checkpoints.</p>
<p>It's good practice to do some of this "detective work", so that you'll feel more comfortable when exploring new models yourself!  So please try the following steps:</p>
<ul>
<li>Go to the <a href="https://blog.tensorflow.org/">TensorFlow Blog</a>, where researchers announce new findings.</li>
<li>In the search box at the top of the page, search for "retinanet".</li>
<li>In the search results, click on the blog post titled "TensorFlow 2 meets the Object Detection API" (it may be the first search result).</li>
<li>Skim through this blog and look for links to either the checkpoints or to Colabs that will show you how to use the checkpoints.</li>
<li>Try to fill out the following code cell below, which does the following:</li>
<li>Download the compressed SSD Resnet 50 version 1, 640 x 640 checkpoint.</li>
<li>Untar (decompress) the tar file</li>
<li>Move the decompressed checkpoint to <code>models/research/object_detection/test_data/</code></li>
</ul>
<p>If you want some help getting started, please click on the "Initial Hints" cell to get some hints.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<details>
<summary>
    <font size="3" color="darkgreen"><b>Initial Hints</b></font>
</summary>
<p>

General Hints to get started
</p>
<ul>
    <li>The link to the blog is <a href="https://blog.tensorflow.org/2020/07/tensorflow-2-meets-object-detection-api.html">TensorFlow 2 meets the Object Detection API</a> </li>
    <li>In the blog, you'll find the text "COCO pre-trained weights, which links to a list of checkpoints in GitHub titled 
      <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md">TensorFlow 2 Detection Model Zoo<a>.  
    </li>
    <li>
          If you read each checkpoint name, you'll find the one for SSD Resnet 50 version 1, 640 by 640.  If you hover your mouse over
    </li>
    <li>
        If you right-click on the desired checkpoint link, you can save the link address, and use it in the code cell below to get the checkpoint.
    </li>
    <li>For more hints, please click on the cell "More Hints"</li>
</ul>
</p>

</details>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<details>
<summary>
    <font size="3" color="darkgreen"><b>More Hints</b></font>
</summary>
<p>

More Hints
</p>
<ul>
    <li> To see how to download the checkpoint, look in the blog for links to Colab tutorials.
    </li>
    <li>
        For example, the blog links to a Colab titled <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/colab_tutorials/inference_tf2_colab.ipynb">Intro to Object Detection Colab</a>
    </li>
    <li>
        In the Colab, you'll see the section titled "Build a detection model and load pre-trained model weights", which is followed by a code cell showing how to download, decompress, and relocate a checkpoint.  Use similar syntax, except use the URL to the ssd resnet50 version 1 640x640 checkpoint instead.
    </li>
    <li> If you're feeling stuck, please click on the cell "Even More Hints".
    </li>
</ul>
</p>

</details>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<details>
<summary>
    <font size="3" color="darkgreen"><b>Even More Hints</b></font>
</summary>
<p>

Even More Hints
</p>
<ul>
    <li> The blog post also links to a notebook titled 
    <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/colab_tutorials/eager_few_shot_od_training_tf2_colab.ipynb">
    Eager Few Shot Object Detection Colab</a>
    </li>
    <li> In this notebook, look for the section titled "Create model and restore weights for all but last layer".  
    The code cell below it shows how to download the exact checkpoint that you're interested in.
    </li>
    <li>You can also review the lecture videos for this week, which show the same code.</li>

</ul>
</p>

</details>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-4'></a></p>
<h3 id="exercise-4-download-checkpoints">Exercise 4: Download checkpoints</h3>
<ul>
<li>Download the compressed SSD Resnet 50 version 1, 640 x 640 checkpoint.</li>
<li>Untar (decompress) the tar file</li>
<li>Move the decompressed checkpoint to <code>models/research/object_detection/test_data/</code></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE ###</span>
<span class="c1"># Download the SSD Resnet 50 version 1, 640x640 checkpoint</span>
<span class="err">!</span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">tensorflow</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">object_detection</span><span class="o">/</span><span class="n">tf2</span><span class="o">/</span><span class="mi">20200711</span><span class="o">/</span><span class="n">ssd_resnet50_v1_fpn_640x640_coco17_tpu</span><span class="o">-</span><span class="mf">8.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>

<span class="c1"># untar (decompress) the tar file</span>
<span class="err">!</span><span class="n">tar</span> <span class="o">-</span><span class="n">xf</span> <span class="n">ssd_resnet50_v1_fpn_640x640_coco17_tpu</span><span class="o">-</span><span class="mf">8.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>

<span class="c1"># copy the checkpoint to the test_data folder models/research/object_detection/test_data/</span>
<span class="err">!</span><span class="n">mv</span> <span class="n">ssd_resnet50_v1_fpn_640x640_coco17_tpu</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="n">checkpoint</span> <span class="n">models</span><span class="o">/</span><span class="n">research</span><span class="o">/</span><span class="n">object_detection</span><span class="o">/</span><span class="n">test_data</span><span class="o">/</span>

<span class="c1">### END CODE HERE</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="configure-the-model">Configure the model</h2>
<p>Here, you will configure the model for this use case.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-5-1'></a></p>
<h3 id="exercise-51-locate-and-read-from-the-configuration-file"><strong>Exercise 5.1</strong>: Locate and read from the configuration file</h3>
<h4 id="pipeline_config">pipeline_config</h4>
<ul>
<li>In the Colab, on the left side table of contents, click on the folder icon to display the file browser for the current workspace.  </li>
<li>Navigate to <code>models/research/object_detection/configs/tf2</code>.  The folder has multiple .config files.  </li>
<li>Look for the file corresponding to ssd resnet 50 version 1 640x640.</li>
<li>You can double-click the config file to view its contents. This may help you as you complete the next few code cells to configure your model.</li>
<li>Set the <code>pipeline_config</code> to a string that contains the full path to the resnet config file, in other words: <code>models/research/.../... .config</code></li>
</ul>
<h4 id="configs">configs</h4>
<p>If you look at the module <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/utils/config_util.py">config_util</a> that you imported, it contains the following function:</p>
<p><div class="highlight"><pre><span></span><code>def get_configs_from_pipeline_file(pipeline_config_path, config_override=None):
</code></pre></div>
- Please use this function to load the configuration from your <code>pipeline_config</code>.
  - <code>configs</code> will now contain a dictionary.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">clear_session</span><span class="p">()</span>


<span class="c1">### START CODE HERE ###</span>
<span class="c1"># define the path to the .config file for ssd resnet 50 v1 640x640</span>
<span class="n">pipeline_config</span> <span class="o">=</span> <span class="s1">&#39;/content/models/research/object_detection/configs/tf2/ssd_resnet50_v1_fpn_640x640_coco17_tpu-8.config&#39;</span>

<span class="c1"># Load the configuration file into a dictionary</span>
<span class="n">configs</span> <span class="o">=</span> <span class="n">config_util</span><span class="o">.</span><span class="n">get_configs_from_pipeline_file</span><span class="p">(</span><span class="n">pipeline_config</span><span class="p">)</span>

<span class="c1">### END CODE HERE ###</span>
<span class="c1"># See what configs looks like</span>
<span class="n">configs</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-5-2'></a></p>
<h3 id="exercise-52-get-the-model-configuration"><strong>Exercise 5.2</strong>: Get the model configuration</h3>
<h4 id="model_config">model_config</h4>
<ul>
<li>From the <code>configs</code> dictionary, access the object associated with the key 'model'.</li>
<li><code>model_config</code> now contains an object of type <code>object_detection.protos.model_pb2.DetectionModel</code>.  </li>
<li>If you print <code>model_config</code>, you'll see something like this:</li>
</ul>
<div class="highlight"><pre><span></span><code>ssd {
  num_classes: 90
  image_resizer {
    fixed_shape_resizer {
      height: 640
      width: 640
    }
  }
  feature_extractor {
...
...
  freeze_batchnorm: false
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE ###</span>
<span class="c1"># Read in the object stored at the key &#39;model&#39; of the configs dictionary</span>
<span class="n">model_config</span> <span class="o">=</span> <span class="n">configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>

<span class="c1">### END CODE HERE</span>
<span class="c1"># see what model_config looks like</span>
<span class="n">model_config</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-5-3'></a></p>
<h3 id="exercise-53-modify-model_config"><strong>Exercise 5.3</strong>: Modify model_config</h3>
<ul>
<li>Modify num_classes from the default <code>90</code> to the <code>num_classes</code> that you set earlier in this notebook.</li>
<li>num_classes is nested under ssd.  You'll need to use dot notation 'obj.x' and NOT bracket notation obj['x']` to access num_classes.</li>
<li>Freeze batch normalization </li>
<li>Batch normalization is not frozen in the default configuration.</li>
<li>If you inspect the <code>model_config</code> object, you'll see that <code>freeze_batchnorm</code> is nested under <code>ssd</code> just like <code>num_classes</code>.</li>
<li>Freeze batch normalization by setting the relevant field to <code>True</code>.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE ###</span>
<span class="c1"># Modify the number of classes from its default of 90</span>
<span class="n">model_config</span><span class="o">.</span><span class="n">ssd</span><span class="o">.</span><span class="n">num_classes</span> <span class="o">=</span> <span class="n">num_classes</span>

<span class="c1"># Freeze batch normalization</span>
<span class="n">model_config</span><span class="o">.</span><span class="n">ssd</span><span class="o">.</span><span class="n">freeze_batchnorm</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1">### END CODE HERE</span>

<span class="c1"># See what model_config now looks like after you&#39;ve customized it!</span>
<span class="n">model_config</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="build-the-model">Build the model</h2>
<p>Recall that you imported <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/builders/model_builder.py">model_builder</a>.<br />
- You'll use <code>model_builder</code> to build the model according to the configurations that you have just downloaded and customized.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-5.4'></a></p>
<h3 id="exercise-54-build-the-custom-model"><strong>Exercise 5.4</strong>: Build the custom model</h3>
<h4 id="model_builder">model_builder</h4>
<p>model_builder has a function <code>build</code>:</p>
<p><div class="highlight"><pre><span></span><code>def build(model_config, is_training, add_summaries=True):
</code></pre></div>
- model_config: Set this to the model configuration that you just customized.
- is_training: Set this to True.
- You can keep the default value for the remaining parameter.
- Note that it will take some time to build the model.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE (Replace instances of `None` with your code) ###</span>
<span class="n">detection_model</span> <span class="o">=</span> <span class="n">model_builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">model_config</span><span class="o">=</span><span class="n">model_config</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">### END CODE HERE ###</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">detection_model</span><span class="p">))</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output</strong>:</p>
<div class="highlight"><pre><span></span><code>&lt;class &#39;object_detection.meta_architectures.ssd_meta_arch.SSDMetaArch&#39;&gt;
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="restore-weights-from-your-checkpoint">Restore weights from your checkpoint</h2>
<p>Now, you will selectively restore weights from your checkpoint.
- Your end goal is to create a custom model which reuses parts of, but not all of the layers of RetinaNet (currently stored in the variable <code>detection_model</code>.)
  - The parts of RetinaNet that you want to reuse are:
    - Feature extraction layers
    - Bounding box regression prediction layer
  - The part of RetinaNet that you will not want to reuse is the classification prediction layer (since you will define and train your own classification layer specific to zombies).
  - For the parts of RetinaNet that you want to reuse, you will also restore the weights from the checkpoint that you selected.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="inspect-the-detection_model">Inspect the detection_model</h4>
<p>First, take a look at the type of the detection_model and its Python class.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Run this to check the type of detection_model</span>
<span class="n">detection_model</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="find-the-source-code-for-detection_model">Find the source code for detection_model</h4>
<p>You'll see that the type of the model is <code>object_detection.meta_architectures.ssd_meta_arch.SSDMetaArch</code>.
Please practice some detective work and open up the source code for this class in GitHub repository.  Recall that at the start of this assignment, you cloned from this repository:  <a href="https://github.com/tensorflow/models">TensorFlow Models</a>.
- Navigate through these subfolders: models -&gt; research -&gt; object_detection.
  - If you get stuck, go to this link: <a href="https://github.com/tensorflow/models/tree/master/research/object_detection">object_detection</a>
- Take a look at this 'object_detection' folder and look for the remaining folders to navigate based on the class type of detection_model: object_detection.meta_architectures.ssd_meta_arch.SSDMetaArch
  - Hopefully you'll find the meta_architectures folder, and within it you'll notice a file named <code>ssd_meta_arch.py</code>.
  - Please open and view this <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/meta_architectures/ssd_meta_arch.py">ssd_meta_arch.py</a> file.</p>
<h4 id="view-the-variables-in-detection_model">View the variables in detection_model</h4>
<p>Now, check the class variables that are in <code>detection_model</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="nb">vars</span><span class="p">(</span><span class="n">detection_model</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You'll see that detection_model contains several variables:</p>
<p>Two of these will be relevant to you:
<div class="highlight"><pre><span></span><code>...
_box_predictor&#39;: &lt;object_detection.predictors.convolutional_keras_box_predictor.WeightSharedConvolutionalBoxPredictor at 0x7f5205eeb1d0&gt;,
...
_feature_extractor&#39;: &lt;object_detection.models.ssd_resnet_v1_fpn_keras_feature_extractor.SSDResNet50V1FpnKerasFeatureExtractor at 0x7f52040f1ef0&gt;,
</code></pre></div></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="inspect-_feature_extractor">Inspect <code>_feature_extractor</code></h4>
<p>Take a look at the <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/meta_architectures/ssd_meta_arch.py">ssd_meta_arch.py</a> code.
<div class="highlight"><pre><span></span><code># Line 302
feature_extractor: a SSDFeatureExtractor object.
</code></pre></div>
Also
<div class="highlight"><pre><span></span><code># Line 380
self._feature_extractor = feature_extractor
</code></pre></div>
So <code>detection_model._feature_extractor</code> is a feature extractor, which you will want to reuse for your zombie detector model.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="inspect-_box_predictor">Inspect <code>_box_predictor</code></h4>
<ul>
<li>View the <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/meta_architectures/ssd_meta_arch.py">ssd_meta_arch.py</a> file (which is the source code for detection_model)</li>
<li>Notice that in the <strong>init</strong> constructor for class SSDMetaArch(model.DetectionModel), 
<div class="highlight"><pre><span></span><code>...
box_predictor: a box_predictor.BoxPredictor object
...
self._box_predictor = box_predictor
</code></pre></div></li>
</ul>
<h4 id="inspect-_box_predictor_1">Inspect _box_predictor</h4>
<p>Please take a look at the class type of <code>detection_model._box_predictor</code></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># view the type of _box_predictor</span>
<span class="n">detection_model</span><span class="o">.</span><span class="n">_box_predictor</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You'll see that the class type of _box_predictor is
<div class="highlight"><pre><span></span><code>object_detection.predictors.convolutional_keras_box_predictor.WeightSharedConvolutionalBoxPredictor
</code></pre></div>
You can navigate through the GitHub repository to this path:
- <a href="https://github.com/tensorflow/models/tree/master/research/object_detection/predictors">objection_detection/predictors</a>
- Notice that there is a file named convolutional_keras_box_predictor.py.  Please open that file.</p>
<h4 id="view-variables-in-_box_predictor">View variables in <code>_box_predictor</code></h4>
<p>Also view the variables contained in _box_predictor:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="nb">vars</span><span class="p">(</span><span class="n">detection_model</span><span class="o">.</span><span class="n">_box_predictor</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Among the variables listed, a few will be relevant to you:</p>
<div class="highlight"><pre><span></span><code>...
_base_tower_layers_for_heads
...
_box_prediction_head
...
_prediction_heads
</code></pre></div>
<p>In the source code for <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/predictors/convolutional_keras_box_predictor.py">convolutional_keras_box_predictor.py</a> that you just opened, look at the source code to get a sense for what these three variables represent.</p>
<h4 id="inspect-base_tower_layers_for_heads">Inspect <code>base_tower_layers_for_heads</code></h4>
<p>If you look at the <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/predictors/convolutional_keras_box_predictor.py">convolutional_keras_box_predictor.py</a> file, you'll notice this:
<div class="highlight"><pre><span></span><code># line 302
self._base_tower_layers_for_heads = {
        BOX_ENCODINGS: [],
        CLASS_PREDICTIONS_WITH_BACKGROUND: [],
    }
</code></pre></div>
- <code>base_tower_layers_for_heads</code> is a dictionary with two key-value pairs.
  - <code>BOX_ENCODINGS</code>: points to a list of layers
  - <code>CLASS_PREDICTIONS_WITH_BACKGROUND</code>: points to a list of layers
  - If you scan the code, you'll see that for both of these, the lists are filled with all layers that appear BEFORE the prediction layer.
<div class="highlight"><pre><span></span><code># Line 377
# Stack the base_tower_layers in the order of conv_layer, batch_norm_layer
    # and activation_layer
    base_tower_layers = []
    for i in range(self._num_layers_before_predictor):
</code></pre></div></p>
<p>So <code>detection_model.box_predictor._base_tower_layers_for_heads</code> contains:
- The layers for the prediction before the final bounding box prediction
- The layers for the prediction before the final class prediction.</p>
<p>You will want to use these in your model.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="inspect-_box_prediction_head">Inspect <code>_box_prediction_head</code></h4>
<p>If you again look at <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/predictors/convolutional_keras_box_predictor.py">convolutional_keras_box_predictor.py</a> file, you'll see this</p>
<p><div class="highlight"><pre><span></span><code># Line 248
box_prediction_head: The head that predicts the boxes.
</code></pre></div>
So <code>detection_model.box_predictor._box_prediction_head</code> points to the bounding box prediction layer, which you'll want to use for your model.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="inspect-_prediction_heads">Inspect <code>_prediction_heads</code></h4>
<p>If you again look at <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/predictors/convolutional_keras_box_predictor.py">convolutional_keras_box_predictor.py</a> file, you'll see this
<div class="highlight"><pre><span></span><code># Line 121
self._prediction_heads = {
        BOX_ENCODINGS: box_prediction_heads,
        CLASS_PREDICTIONS_WITH_BACKGROUND: class_prediction_heads,
    }
</code></pre></div>
You'll also see this docstring
<div class="highlight"><pre><span></span><code># Line 83
class_prediction_heads: A list of heads that predict the classes.
</code></pre></div></p>
<p>So <code>detection_model.box_predictor._prediction_heads</code> is a dictionary that points to both prediction layers:
- The layer that predicts the bounding boxes
- The layer that predicts the class (category).</p>
<h4 id="which-layers-will-you-reuse">Which layers will you reuse?</h4>
<p>Remember that you are reusing the model for its feature extraction and bounding box detection.
- You will create your own classification layer and train it on zombie images.
- So you won't need to reuse the class prediction layer of <code>detection_model</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="define-checkpoints-for-desired-layers">Define checkpoints for desired layers</h2>
<p>You will now isolate the layers of <code>detection_model</code> that you wish to reuse so that you can restore the weights to just those layers.
- First, define checkpoints for the box predictor
- Next, define checkpoints for the model, which will point to this box predictor checkpoint as well as the feature extraction layers.</p>
<p>Please use <a href="https://www.tensorflow.org/api_docs/python/tf/train/Checkpoint">tf.train.Checkpoint</a>.</p>
<p>As a reminder of how to use tf.train.Checkpoint:</p>
<p><div class="highlight"><pre><span></span><code>tf.train.Checkpoint(
    **kwargs
)
</code></pre></div>
Pretend that <code>detection_model</code> contains these variables for which you want to restore weights:
- <code>detection_model._ice_cream_sundae</code>
- 'detection_model._pies._apple_pie<code>- 'detection_model._pies._pecan_pie</code></p>
<p>Notice that the pies are nested within <code>._pies</code>.</p>
<p>If you just want the ice cream sundae and apple pie variables (and not the pecan pie) then you can do the following:</p>
<div class="highlight"><pre><span></span><code>tmp_pies_checkpoint = tf.train.Checkpoint(
  _apple_pie = detection_model._pies._apple_pie
)
</code></pre></div>
<p>Next, in order to connect these together in a node graph, do this:
<div class="highlight"><pre><span></span><code>tmp_model_checkpoint = tf.train.Checkpoint(
  _pies = tmp_pies_checkpoint,
  _ice_cream_sundae = detection_model._ice_cream_sundae
)
</code></pre></div></p>
<p>Finally, define a checkpoint that uses the key <code>model</code> and takes in the tmp_model_checkpoint.</p>
<div class="highlight"><pre><span></span><code>checkpoint = tf.train.Checkpoint(
  model = tmp_model_checkpoint
)
</code></pre></div>
<p>You'll then be ready to restore the weights from the checkpoint that you downloaded.</p>
<p>Try this out step by step!</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-6-1'></a></p>
<h3 id="exercise-61-define-checkpoints-for-the-box-predictor">Exercise 6.1: Define Checkpoints for the box predictor</h3>
<ul>
<li>Please define <code>box_predictor_checkpoint</code> to be checkpoint for these two layers of the <code>detection_model</code>'s box predictor:</li>
<li>The base tower layer (the layers the precede both the class prediction and bounding box prediction layers).</li>
<li>The box prediction head (the prediction layer for bounding boxes).</li>
<li>Note, you won't include the class prediction layer.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE ###</span>

<span class="n">tmp_box_predictor_checkpoint</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Checkpoint</span><span class="p">(</span>
    <span class="n">_base_tower_layers_for_heads</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">_box_predictor</span><span class="o">.</span><span class="n">_base_tower_layers_for_heads</span><span class="p">,</span>
    <span class="n">_box_prediction_head</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">_box_predictor</span><span class="o">.</span><span class="n">_box_prediction_head</span>
<span class="p">)</span>  

<span class="c1">### END CODE HERE</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Check the datatype of this checkpoint</span>
<span class="nb">type</span><span class="p">(</span><span class="n">tmp_box_predictor_checkpoint</span><span class="p">)</span>

<span class="c1"># Expected output:</span>
<span class="c1"># tensorflow.python.training.tracking.util.Checkpoint</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Check the variables of this checkpoint</span>
<span class="nb">vars</span><span class="p">(</span><span class="n">tmp_box_predictor_checkpoint</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="expected-output">Expected output</h4>
<p>You should expect to see a list of variables that include the following:
<div class="highlight"><pre><span></span><code> ...
 &#39;_base_tower_layers_for_heads&#39;: {&#39;box_encodings&#39;: ListWrapper([]),
  &#39;class_predictions_with_background&#39;: ListWrapper([])},
 &#39;_box_prediction_head&#39;: &lt;object_detection.predictors.heads.keras_box_head.WeightSharedConvolutionalBoxHead at 0x7f49d0234450&gt;,
 ... 
</code></pre></div></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-6-2'></a></p>
<h3 id="exercise-62-define-the-temporary-model-checkpoint">Exercise 6.2: Define the temporary model checkpoint**</h3>
<p>Now define <code>tmp_model_checkpoint</code> so that it points to these two layers:
- The feature extractor of the detection model.
- The temporary box predictor checkpoint that you just defined.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE ###</span>

<span class="n">tmp_model_checkpoint</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Checkpoint</span><span class="p">(</span>
    <span class="n">_box_predictor</span> <span class="o">=</span> <span class="n">tmp_box_predictor_checkpoint</span><span class="p">,</span>
    <span class="n">_feature_extractor</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">_feature_extractor</span>
<span class="p">)</span>         

<span class="c1">### END CODE HERE ###</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Check the datatype of this checkpoint</span>
<span class="nb">type</span><span class="p">(</span><span class="n">tmp_model_checkpoint</span><span class="p">)</span>

<span class="c1"># Expected output</span>
<span class="c1"># tensorflow.python.training.tracking.util.Checkpoint</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Check the vars of this checkpoint</span>
<span class="nb">vars</span><span class="p">(</span><span class="n">tmp_model_checkpoint</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="expected-output_1">Expected output</h4>
<p>Among the variables of this checkpoint, you should see:
<div class="highlight"><pre><span></span><code>&#39;_box_predictor&#39;: &lt;tensorflow.python.training.tracking.util.Checkpoint at 0x7fefac044a20&gt;,
 &#39;_feature_extractor&#39;: &lt;object_detection.models.ssd_resnet_v1_fpn_keras_feature_extractor.SSDResNet50V1FpnKerasFeatureExtractor at 0x7fefac0240b8&gt;,
</code></pre></div></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-6-3'></a></p>
<h3 id="exercise-63-restore-the-checkpoint">Exercise 6.3: Restore the checkpoint</h3>
<p>You can now restore the checkpoint.</p>
<p>First, find and set the <code>checkpoint_path</code></p>
<ul>
<li>checkpoint_path: </li>
<li>Using the "files" browser in the left side of Colab, navigate to <code>models -&gt; research -&gt; object_detection -&gt; test_data</code>. </li>
<li>If you completed the previous code cell that downloads and moves the checkpoint, you'll see a subfolder named "checkpoint".  <ul>
<li>The 'checkpoint' folder contains three files:</li>
<li>checkpoint</li>
<li>ckpt-0.data-00000-of-00001</li>
<li>ckpt-0.index</li>
<li>Please set checkpoint_path to the path to the full path <code>models/.../ckpt-0</code> </li>
<li>Notice that you don't want to include a file extension after <code>ckpt-0</code>.</li>
<li><strong>IMPORTANT</strong>: Please don't set the path to include the <code>.index</code> extension in the checkpoint file name.  </li>
<li>If you do set it to <code>ckpt-0.index</code>, there won't be any immediate error message, but later during training, you'll notice that your model's loss doesn't improve, which means that the pre-trained weights were not restored properly.</li>
</ul>
</li>
</ul>
<p>Next, define one last checkpoint using <code>tf.train.Checkpoint()</code>.
- For the single keyword argument, 
  - Set the key as <code>model=</code> 
  - Set the value to your temporary model checkpoint that you just defined.
- <strong>IMPORTANT</strong>: You'll need to set the keyword argument as <code>model=</code> and not something else like <code>detection_model=</code>.
- If you set this keyword argument to anything else, it won't show an immmediate error, but when you train your model on the zombie images, your model loss will not decrease (your model will not learn).</p>
<p>Finally, call this checkpoint's <code>.restore()</code> function, passing in the path to the checkpoint.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE ###</span>

<span class="n">checkpoint_path</span> <span class="o">=</span> <span class="s1">&#39;models/research/object_detection/test_data/checkpoint/ckpt-0&#39;</span>

<span class="c1"># Define a checkpoint that sets `model= None</span>
<span class="n">checkpoint</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Checkpoint</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">tmp_model_checkpoint</span>
<span class="p">)</span>

<span class="c1"># Restore the checkpoint to the checkpoint path</span>
<span class="n">checkpoint</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">)</span>

<span class="c1">### END CODE HERE ###</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-7'></a></p>
<h3 id="exercise-7-run-a-dummy-image-to-generate-the-model-variables"><strong>Exercise 7</strong>: Run a dummy image to generate the model variables</h3>
<p>Run a dummy image through the model so that variables are created. We need to select the trainable variables later in Exercise 9 and right now, it is still empty. Try running <code>len(detection_model.trainable_variables)</code> in a code cell and you will get <code>0</code>. We will pass in a dummy image through the forward pass to create these variables.</p>
<p>Recall that <code>detection_model</code> is an object of type <a href="">object_detection.meta_architectures.ssd_meta_arch.SSDMetaArch</a> </p>
<p>Important methods that are available in the <code>detection_model</code> object  are:
- <a href="https://github.com/tensorflow/models/blob/dc4d11216b738920ddb136729e3ae71bddb75c7e/research/object_detection/meta_architectures/ssd_meta_arch.py#L459">preprocess()</a>: 
    - takes in a tensor representing an image and returns
    - returns <code>image, shapes</code>
    - For the dummy image, you can declare a <a href="https://www.tensorflow.org/api_docs/python/tf/zeros">tensor of zeros</a> that has a shape that the <code>preprocess()</code> method can accept (i.e. [batch, height, width, channels]). 
    - Remember that your images have dimensions 640 x 640 x 3. 
    - You can pass in a batch of 1 when making the dummy image. </p>
<ul>
<li><a href="https://github.com/tensorflow/models/blob/dc4d11216b738920ddb136729e3ae71bddb75c7e/research/object_detection/meta_architectures/ssd_meta_arch.py#L525">predict()</a></li>
<li>takes in <code>image, shapes</code> which are created by the <code>preprocess()</code> function call.</li>
<li>returns a prediction in a Python dictionary</li>
<li>
<p>this will pass the dummy image through the forward pass of the network and create the model variables</p>
</li>
<li>
<p><a href="https://github.com/tensorflow/models/blob/dc4d11216b738920ddb136729e3ae71bddb75c7e/research/object_detection/meta_architectures/ssd_meta_arch.py#L655">postprocess()</a></p>
</li>
<li>Takes in the prediction_dict and shapes</li>
<li>returns a dictionary of post-processed predictions of detected objects ("detections").</li>
</ul>
<p><strong>Note</strong>: Please use the recommended variable names, which include the prefix <code>tmp_</code>, since these variables won't be used later, but you'll define similarly-named variables later for predicting on actual zombie images. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE (Replace instances of `None` with your code)###</span>

<span class="c1"># use the detection model&#39;s `preprocess()` method and pass a dummy image</span>
<span class="n">tmp_image</span><span class="p">,</span> <span class="n">tmp_shapes</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>

<span class="c1"># run a prediction with the preprocessed image and shapes</span>
<span class="n">tmp_prediction_dict</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">tmp_image</span><span class="p">,</span> <span class="n">tmp_shapes</span><span class="p">)</span>

<span class="c1"># postprocess the predictions into final detections</span>
<span class="n">tmp_detections</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">tmp_prediction_dict</span><span class="p">,</span> <span class="n">tmp_shapes</span><span class="p">)</span>

<span class="c1">### END CODE HERE ###</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Weights restored!&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Test Code:</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">detection_model</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Please pass in a dummy image to create the trainable variables.&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">detection_model</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">detection_model</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">231</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">detection_model</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="mi">462</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output</strong>:</p>
<div class="highlight"><pre><span></span><code>(3, 3, 256, 24)
(512,)
(256,)
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="eager-mode-custom-training-loop">Eager mode custom training loop</h2>
<p>With the data and model now setup, you can now proceed to configure the training.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-8'></a></p>
<h3 id="exercise-8-set-training-hyperparameters"><strong>Exercise 8</strong>: Set training hyperparameters</h3>
<p>Set an appropriate learning rate and optimizer for the training. </p>
<ul>
<li>batch_size: you can use 4</li>
<li>You can increase the batch size up to 5, since you have just 5 images for training.</li>
<li>num_batches: You can use 100</li>
<li>You can increase the number of batches but the training will take longer to complete. </li>
<li>learning_rate: You can use 0.01</li>
<li>When you run the training loop later, notice how the initial loss INCREASES` before decreasing. </li>
<li>You can try a lower learning rate to see if you can avoid this increased loss.</li>
<li>optimizer: you can use <a href="https://www.tensorflow.org/api_docs/python/tf/keras/optimizers/SGD">tf.keras.optimizers.SGD</a></li>
<li>Set the learning rate</li>
<li>Set the momentum to 0.9</li>
</ul>
<p>Training will be fairly quick, so we do encourage you to experiment a bit with these hyperparameters!</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set_learning_phase</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">### START CODE HERE (Replace instances of `None` with your code)###</span>

<span class="c1"># set the batch_size</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># set the number of batches</span>
<span class="n">num_batches</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Set the learning rate</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># set the optimizer and pass in the learning_rate</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

<span class="c1">### END CODE HERE ###</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="choose-the-layers-to-fine-tune">Choose the layers to fine-tune</h2>
<p>To make use of transfer learning and pre-trained weights, you will train just certain parts of the detection model, namely, the last prediction layers.
- Please take a minute to inspect the layers of <code>detection_model</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Inspect the layers of detection_model</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">detection_model</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;i: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> name: </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> shape:</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> dtype=</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice that there are some layers whose names are prefixed with the following:
<div class="highlight"><pre><span></span><code>WeightSharedConvolutionalBoxPredictor/WeightSharedConvolutionalBoxHead
...
WeightSharedConvolutionalBoxPredictor/WeightSharedConvolutionalClassHead
...
WeightSharedConvolutionalBoxPredictor/BoxPredictionTower
...
WeightSharedConvolutionalBoxPredictor/ClassPredictionTower
...
</code></pre></div></p>
<p>Among these, which do you think are the prediction layers at the "end" of the model?
- Recall that when inspecting the source code to restore the checkpoints (<a href="https://github.com/tensorflow/models/blob/master/research/object_detection/predictors/convolutional_keras_box_predictor.py">convolutional_keras_box_predictor.py</a>) you noticed that:
  - <code>_base_tower_layers_for_heads</code>: refers to the layers that are placed right before the prediction layer
  - <code>_box_prediction_head</code> refers to the prediction layer for the bounding boxes
  - <code>_prediction_heads</code>: refers to the set of prediction layers (both for classification and for bounding boxes)</p>
<p>So you can see that in the source code for this model, "tower" refers to layers that are before the prediction layer, and "head" refers to the prediction layers.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-9'></a></p>
<h3 id="exercise-9-select-the-prediction-layer-variables"><strong>Exercise 9</strong>: Select the prediction layer variables</h3>
<p>Based on inspecting the <code>detection_model.trainable_variables</code>, please select the prediction layer variables that you will fine tune:
- The bounding box head variables (which predict bounding box coordinates)
- The class head variables (which predict the class/category)</p>
<p>You have a few options for doing this:
- You can access them by their list index:
<div class="highlight"><pre><span></span><code>detection_model.trainable_variables[92]
</code></pre></div></p>
<ul>
<li>Alternatively, you can use string matching to select the variables:
<div class="highlight"><pre><span></span><code>tmp_list = []
for v in detection_model.trainable_variables:
  if v.name.startswith(&#39;ResNet50V1_FPN/bottom_up_block5&#39;):
    tmp_list.append(v)
</code></pre></div></li>
</ul>
<p><strong>Hint</strong>: There are a total of four variables that you want to fine tune.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1">### START CODE HERE (Replace instances of `None` with your code) ###</span>

<span class="c1"># define a list that contains the layers that you wish to fine tune</span>
<span class="n">to_fine_tune</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;WeightSharedConvolutionalBoxPredictor/WeightSharedConvolutional&#39;</span><span class="p">):</span>
    <span class="n">to_fine_tune</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="c1">### END CODE HERE</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Test Code:</span>

<span class="nb">print</span><span class="p">(</span><span class="n">to_fine_tune</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">to_fine_tune</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output</strong>:</p>
<div class="highlight"><pre><span></span><code>WeightSharedConvolutionalBoxPredictor/WeightSharedConvolutionalBoxHead/BoxPredictor/kernel:0
WeightSharedConvolutionalBoxPredictor/WeightSharedConvolutionalClassHead/ClassPredictor/kernel:0
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="train-your-model">Train your model</h2>
<p>You'll define a function that handles training for one batch, which you'll later use in your training loop.</p>
<p>First, walk through these code cells to learn how you'll perform training using this model.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Get a batch of your training images</span>
<span class="n">g_images_list</span> <span class="o">=</span> <span class="n">train_image_tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>detection_model</code> is of class <a href="https://github.com/tensorflow/models/blob/dc4d11216b738920ddb136729e3ae71bddb75c7e/research/object_detection/meta_architectures/ssd_meta_arch.py#L655">SSDMetaArch</a>, and its source code shows that is has this function <a href="https://github.com/tensorflow/models/blob/dc4d11216b738920ddb136729e3ae71bddb75c7e/research/object_detection/meta_architectures/ssd_meta_arch.py#L459">preprocess</a>.
- This preprocesses the images so that they can be passed into the model (for training or prediction):
<div class="highlight"><pre><span></span><code>  def preprocess(self, inputs):
    &quot;&quot;&quot;Feature-extractor specific preprocessing.
    ...
    Args:
      inputs: a [batch, height_in, width_in, channels] float tensor representing
        a batch of images with values between 0 and 255.0.
    Returns:
      preprocessed_inputs: a [batch, height_out, width_out, channels] float
        tensor representing a batch of images.

      true_image_shapes: int32 tensor of shape [batch, 3] where each row is
        of the form [height, width, channels] indicating the shapes
        of true images in the resized images, as resized images can be padded
        with zeros.
</code></pre></div></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Use .preprocess to preprocess an image</span>
<span class="n">g_preprocessed_image</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">g_images_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;g_preprocessed_image type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">g_preprocessed_image</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;g_preprocessed_image length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">g_preprocessed_image</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;index 0 has the preprocessed image of shape </span><span class="si">{</span><span class="n">g_preprocessed_image</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;index 1 has information about the image&#39;s true shape excluding padding: </span><span class="si">{</span><span class="n">g_preprocessed_image</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can pre-process each image and save their outputs into two separate lists
- One list of the preprocessed images
- One list of the true shape for each preprocessed image</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">preprocessed_image_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">true_shape_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">g_images_list</span><span class="p">:</span>
    <span class="n">processed_img</span><span class="p">,</span> <span class="n">true_shape</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">preprocessed_image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_img</span><span class="p">)</span>
    <span class="n">true_shape_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">true_shape</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;preprocessed_image_list is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">preprocessed_image_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;preprocessed_image_list has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">preprocessed_image_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;true_shape_list is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">true_shape_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;true_shape_list has length </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">true_shape_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="make-a-prediction">Make a prediction</h2>
<p>The <code>detection_model</code> also has a <code>.predict</code> function.  According to the source code for <a href="https://github.com/tensorflow/models/blob/dc4d11216b738920ddb136729e3ae71bddb75c7e/research/object_detection/meta_architectures/ssd_meta_arch.py#L525">predict</a></p>
<div class="highlight"><pre><span></span><code>  def predict(self, preprocessed_inputs, true_image_shapes):
    &quot;&quot;&quot;Predicts unpostprocessed tensors from input tensor.
    This function takes an input batch of images and runs it through the forward
    pass of the network to yield unpostprocessesed predictions.
...
    Args:
      preprocessed_inputs: a [batch, height, width, channels] image tensor.

      true_image_shapes: int32 tensor of shape [batch, 3] where each row is
        of the form [height, width, channels] indicating the shapes
        of true images in the resized images, as resized images can be padded
        with zeros.

    Returns:
      prediction_dict: a dictionary holding &quot;raw&quot; prediction tensors:
        1) preprocessed_inputs: the [batch, height, width, channels] image
          tensor.
        2) box_encodings: 4-D float tensor of shape [batch_size, num_anchors,
          box_code_dimension] containing predicted boxes.
        3) class_predictions_with_background: 3-D float tensor of shape
          [batch_size, num_anchors, num_classes+1] containing class predictions
          (logits) for each of the anchors.  Note that this tensor *includes*
          background class predictions (at class index 0).
        4) feature_maps: a list of tensors where the ith tensor has shape
          [batch, height_i, width_i, depth_i].
        5) anchors: 2-D float tensor of shape [num_anchors, 4] containing
          the generated anchors in normalized coordinates.
        6) final_anchors: 3-D float tensor of shape [batch_size, num_anchors, 4]
          containing the generated anchors in normalized coordinates.
        If self._return_raw_detections_during_predict is True, the dictionary
        will also contain:
        7) raw_detection_boxes: a 4-D float32 tensor with shape
          [batch_size, self.max_num_proposals, 4] in normalized coordinates.
        8) raw_detection_feature_map_indices: a 3-D int32 tensor with shape
          [batch_size, self.max_num_proposals].
    &quot;&quot;&quot;
</code></pre></div>
<p>Notice that <code>.predict</code> takes its inputs as tensors.  If you tried to pass in the preprocessed images and true shapes, you'll get an error.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Try to call `predict` and pass in lists; look at the error message</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">detection_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">preprocessed_image_list</span><span class="p">,</span> <span class="n">true_shape_list</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error message:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But don't worry! You can check how to properly use <code>predict</code>:
- Notice that the source code documentation says that <code>preprocessed_inputs</code> and <code>true_image_shapes</code> are expected to be tensors and not lists of tensors.
- One way to turn a list of tensors into a tensor is to use <a href="https://www.tensorflow.org/api_docs/python/tf/concat">tf.concat</a></p>
<div class="highlight"><pre><span></span><code>tf.concat(
    values, axis, name=&#39;concat&#39;
)
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Turn a list of tensors into a tensor</span>
<span class="n">preprocessed_image_tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preprocessed_image_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">true_shape_tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">true_shape_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;preprocessed_image_tensor shape: </span><span class="si">{</span><span class="n">preprocessed_image_tensor</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;true_shape_tensor shape: </span><span class="si">{</span><span class="n">true_shape_tensor</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now you can make predictions for the images.
According to the source code, <code>predict</code> returns a dictionary containing the prediction information, including:
- The bounding box predictions
- The class predictions</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Make predictions on the images</span>
<span class="n">prediction_dict</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">preprocessed_image_tensor</span><span class="p">,</span> <span class="n">true_shape_tensor</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keys in prediction_dict:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prediction_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="calculate-loss">Calculate loss</h4>
<p>Now that your model has made its prediction, you want to compare it to the ground truth in order to calculate a loss.
- The <code>detection_model</code> has a <a href="https://github.com/tensorflow/models/blob/dc4d11216b738920ddb136729e3ae71bddb75c7e/research/object_detection/meta_architectures/ssd_meta_arch.py#L807">loss</a> function.</p>
<p><div class="highlight"><pre><span></span><code>  <span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_dict</span><span class="p">,</span> <span class="n">true_image_shapes</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute scalar loss tensors with respect to provided groundtruth.</span>
<span class="sd">    Calling this function requires that groundtruth tensors have been</span>
<span class="sd">    provided via the provide_groundtruth function.</span>
<span class="sd">    Args:</span>
<span class="sd">      prediction_dict: a dictionary holding prediction tensors with</span>
<span class="sd">        1) box_encodings: 3-D float tensor of shape [batch_size, num_anchors,</span>
<span class="sd">          box_code_dimension] containing predicted boxes.</span>
<span class="sd">        2) class_predictions_with_background: 3-D float tensor of shape</span>
<span class="sd">          [batch_size, num_anchors, num_classes+1] containing class predictions</span>
<span class="sd">          (logits) for each of the anchors. Note that this tensor *includes*</span>
<span class="sd">          background class predictions.</span>
<span class="sd">      true_image_shapes: int32 tensor of shape [batch, 3] where each row is</span>
<span class="sd">        of the form [height, width, channels] indicating the shapes</span>
<span class="sd">        of true images in the resized images, as resized images can be padded</span>
<span class="sd">        with zeros.</span>
<span class="sd">      scope: Optional scope name.</span>
<span class="sd">    Returns:</span>
<span class="sd">      a dictionary mapping loss keys (`localization_loss` and</span>
<span class="sd">        `classification_loss`) to scalar tensors representing corresponding loss</span>
<span class="sd">        values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
It takes in:
- The prediction dictionary that comes from your call to <code>.predict()</code>.
- the true images shape that comes from your call to <code>.preprocess()</code> followed by the conversion from a list to a tensor.</p>
<p>Try calling <code>.loss</code>.  You'll see an error message that you'll addres in order to run the <code>.loss</code> function.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="n">losses_dict</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="n">prediction_dict</span><span class="p">,</span> <span class="n">true_shape_tensor</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is giving an error about groundtruth_classes_list: 
<div class="highlight"><pre><span></span><code>The graph tensor has name: groundtruth_classes_list:0
</code></pre></div></p>
<p>Notice in the docstring for <code>loss</code> (shown above), it says:
<div class="highlight"><pre><span></span><code>Calling this function requires that groundtruth tensors have been
    provided via the provide_groundtruth function.
</code></pre></div></p>
<p>So you'll first want to set the ground truth (true labels and true bounding boxes) before you calculate the loss.
- This makes sense, since the loss is comparing the prediction to the ground truth, and so the loss function needs to know the ground truth.</p>
<h4 id="provide-the-ground-truth">Provide the ground truth</h4>
<p>The source code for providing the ground truth is located in the parent class of <code>SSDMetaArch</code>, <code>model.DetectionModel</code>.
- Here is the link to the code for <a href="https://github.com/tensorflow/models/blob/fd6b24c19c68af026bb0a9efc9f7b1719c231d3d/research/object_detection/core/model.py#L297">provide_ground_truth</a></p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">provide_groundtruth</span><span class="p">(</span>
      <span class="bp">self</span><span class="p">,</span>
      <span class="n">groundtruth_boxes_list</span><span class="p">,</span>
      <span class="n">groundtruth_classes_list</span><span class="p">,</span>
<span class="o">...</span> <span class="c1"># more parameters not show here</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">      groundtruth_boxes_list: a list of 2-D tf.float32 tensors of shape</span>
<span class="sd">        [num_boxes, 4] containing coordinates of the groundtruth boxes.</span>
<span class="sd">          Groundtruth boxes are provided in [y_min, x_min, y_max, x_max]</span>
<span class="sd">          format and assumed to be normalized and clipped</span>
<span class="sd">          relative to the image window with y_min &lt;= y_max and x_min &lt;= x_max.</span>
<span class="sd">      groundtruth_classes_list: a list of 2-D tf.float32 one-hot (or k-hot)</span>
<span class="sd">        tensors of shape [num_boxes, num_classes] containing the class targets</span>
<span class="sd">        with the 0th index assumed to map to the first non-background class.</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
You'll set two parameters in <code>provide_ground_truth</code>:
- The true bounding boxes
- The true classes</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Get the ground truth bounding boxes</span>
<span class="n">gt_boxes_list</span> <span class="o">=</span> <span class="n">gt_box_tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Get the ground truth class labels</span>
<span class="n">gt_classes_list</span> <span class="o">=</span> <span class="n">gt_classes_one_hot_tensors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Provide the ground truth to the model</span>
<span class="n">detection_model</span><span class="o">.</span><span class="n">provide_groundtruth</span><span class="p">(</span>
            <span class="n">groundtruth_boxes_list</span><span class="o">=</span><span class="n">gt_boxes_list</span><span class="p">,</span>
            <span class="n">groundtruth_classes_list</span><span class="o">=</span><span class="n">gt_classes_list</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now you can calculate the loss</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Calculate the loss after you&#39;ve provided the ground truth </span>
<span class="n">losses_dict</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="n">prediction_dict</span><span class="p">,</span> <span class="n">true_shape_tensor</span><span class="p">)</span>

<span class="c1"># View the loss dictionary</span>
<span class="n">losses_dict</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="n">prediction_dict</span><span class="p">,</span> <span class="n">true_shape_tensor</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;loss dictionary keys: </span><span class="si">{</span><span class="n">losses_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;localization loss </span><span class="si">{</span><span class="n">losses_dict</span><span class="p">[</span><span class="s1">&#39;Loss/localization_loss&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;classification loss </span><span class="si">{</span><span class="n">losses_dict</span><span class="p">[</span><span class="s1">&#39;Loss/classification_loss&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can now calculate the gradient and optimize the variables that you selected to fine tune.
- Use tf.GradientTape</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
    <span class="c1"># Make the prediction </span>

    <span class="c1"># calculate the loss</span>

    <span class="c1"># calculate the gradient of each model variable with respect to each loss</span>
    <span class="n">gradients</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">([</span><span class="n">some</span> <span class="n">loss</span><span class="p">],</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">fine</span> <span class="n">tune</span><span class="p">)</span>

    <span class="c1"># apply the gradients to update these model variables</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gradients</span><span class="p">,</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">fine</span> <span class="n">tune</span><span class="p">))</span>
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Let&#39;s just reset the model so that you can practice setting it up yourself!</span>
<span class="n">detection_model</span><span class="o">.</span><span class="n">provide_groundtruth</span><span class="p">(</span><span class="n">groundtruth_boxes_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">groundtruth_classes_list</span><span class="o">=</span><span class="p">[])</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-10'></a></p>
<h3 id="exercise-10-define-the-training-step"><strong>Exercise 10</strong>: Define the training step</h3>
<p>Please complete the function below to set up one training step.
- Preprocess the images
- Make a prediction
- Calculate the loss (and make sure the loss function has the ground truth to compare with the prediction)
- Calculate the total loss:
  - <code>total_loss</code> = <code>localization_loss + classification_loss</code>
  - Note: this is different than the example code that you saw above
- Calculate gradients with respect to the variables you selected to train.
- Optimize the model's variables</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">train_step_fn</span><span class="p">(</span><span class="n">image_list</span><span class="p">,</span>
                <span class="n">groundtruth_boxes_list</span><span class="p">,</span>
                <span class="n">groundtruth_classes_list</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">optimizer</span><span class="p">,</span>
                <span class="n">vars_to_fine_tune</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A single training iteration.</span>

<span class="sd">    Args:</span>
<span class="sd">      image_list: A list of [1, height, width, 3] Tensor of type tf.float32.</span>
<span class="sd">        Note that the height and width can vary across images, as they are</span>
<span class="sd">        reshaped within this function to be 640x640.</span>
<span class="sd">      groundtruth_boxes_list: A list of Tensors of shape [N_i, 4] with type</span>
<span class="sd">        tf.float32 representing groundtruth boxes for each image in the batch.</span>
<span class="sd">      groundtruth_classes_list: A list of Tensors of shape [N_i, num_classes]</span>
<span class="sd">        with type tf.float32 representing groundtruth boxes for each image in</span>
<span class="sd">        the batch.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A scalar tensor representing the total loss for the input batch.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Provide the ground truth to the model</span>
    <span class="n">model</span><span class="o">.</span><span class="n">provide_groundtruth</span><span class="p">(</span>
        <span class="n">groundtruth_boxes_list</span><span class="o">=</span><span class="n">groundtruth_boxes_list</span><span class="p">,</span>
        <span class="n">groundtruth_classes_list</span><span class="o">=</span><span class="n">groundtruth_classes_list</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
    <span class="c1">### START CODE HERE (Replace instances of `None` with your code) ###</span>

        <span class="c1"># Preprocess the images</span>
        <span class="n">preprocessed_image_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">true_shape_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">image_list</span><span class="p">:</span>
            <span class="n">processed_img</span><span class="p">,</span> <span class="n">true_shape</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">preprocessed_image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_img</span><span class="p">)</span>
            <span class="n">true_shape_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">true_shape</span><span class="p">)</span>

        <span class="n">preprocessed_image_tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">preprocessed_image_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">true_shape_tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">true_shape_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Make a prediction</span>
        <span class="n">prediction_dict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">preprocessed_image_tensor</span><span class="p">,</span> <span class="n">true_shape_tensor</span><span class="p">)</span>

        <span class="c1"># Calculate the total loss (sum of both losses)</span>
        <span class="n">losses_dict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="n">prediction_dict</span><span class="p">,</span> <span class="n">true_shape_tensor</span><span class="p">)</span>

        <span class="n">total_loss</span> <span class="o">=</span> <span class="n">losses_dict</span><span class="p">[</span><span class="s1">&#39;Loss/localization_loss&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">losses_dict</span><span class="p">[</span><span class="s1">&#39;Loss/classification_loss&#39;</span><span class="p">]</span>

        <span class="c1"># Calculate the gradients</span>
        <span class="n">gradients</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">([</span><span class="n">total_loss</span><span class="p">],</span> <span class="n">vars_to_fine_tune</span><span class="p">)</span>

        <span class="c1"># Optimize the model&#39;s selected variables</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gradients</span><span class="p">,</span> <span class="n">vars_to_fine_tune</span><span class="p">))</span>

        <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">total_loss</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="run-the-training-loop">Run the training loop</h2>
<p>Run the training loop using the training step function that you just defined.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start fine-tuning!&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_batches</span><span class="p">):</span>
    <span class="c1"># Grab keys for a random subset of examples</span>
    <span class="n">all_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_images_np</span><span class="p">)))</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">all_keys</span><span class="p">)</span>
    <span class="n">example_keys</span> <span class="o">=</span> <span class="n">all_keys</span><span class="p">[:</span><span class="n">batch_size</span><span class="p">]</span>

    <span class="c1"># Get the ground truth</span>
    <span class="n">gt_boxes_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gt_box_tensors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">example_keys</span><span class="p">]</span>
    <span class="n">gt_classes_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gt_classes_one_hot_tensors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">example_keys</span><span class="p">]</span>

    <span class="c1"># get the images</span>
    <span class="n">image_tensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">train_image_tensors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">example_keys</span><span class="p">]</span>

    <span class="c1"># Training step (forward pass + backwards pass)</span>
    <span class="n">total_loss</span> <span class="o">=</span> <span class="n">train_step_fn</span><span class="p">(</span><span class="n">image_tensors</span><span class="p">,</span> 
                               <span class="n">gt_boxes_list</span><span class="p">,</span> 
                               <span class="n">gt_classes_list</span><span class="p">,</span>
                               <span class="n">detection_model</span><span class="p">,</span>
                               <span class="n">optimizer</span><span class="p">,</span>
                               <span class="n">to_fine_tune</span>
                              <span class="p">)</span>

    <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;batch &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_batches</span><span class="p">)</span>
        <span class="o">+</span> <span class="s1">&#39;, loss=&#39;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">total_loss</span><span class="o">.</span><span class="n">numpy</span><span class="p">()),</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done fine-tuning!&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output:</strong></p>
<p>Total loss should be decreasing and should be less than 1 after fine tuning. For example:</p>
<div class="highlight"><pre><span></span><code>Start fine-tuning!
batch 0 of 100, loss=1.2559178
batch 10 of 100, loss=16.067217
batch 20 of 100, loss=8.094654
batch 30 of 100, loss=0.34514275
batch 40 of 100, loss=0.033170983
batch 50 of 100, loss=0.0024622646
batch 60 of 100, loss=0.00074224477
batch 70 of 100, loss=0.0006149876
batch 80 of 100, loss=0.00046916265
batch 90 of 100, loss=0.0004159231
Done fine-tuning!
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="load-test-images-and-run-inference-with-new-model">Load test images and run inference with new model!</h2>
<p>You can now test your model on a new set of images. The cell below downloads 237 images of a walking zombie and stores them in a <code>results/</code> directory.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># uncomment if you want to delete existing files</span>
<span class="err">!</span><span class="n">rm</span> <span class="n">zombie</span><span class="o">-</span><span class="n">walk</span><span class="o">-</span><span class="n">frames</span><span class="o">.</span><span class="n">zip</span>
<span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">./</span><span class="n">zombie</span><span class="o">-</span><span class="n">walk</span>
<span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">./</span><span class="n">results</span>

<span class="c1"># download test images</span>
<span class="err">!</span><span class="n">wget</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">check</span><span class="o">-</span><span class="n">certificate</span> \
    <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">storage</span><span class="o">.</span><span class="n">googleapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tensorflow</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">public</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span><span class="n">zombie</span><span class="o">-</span><span class="n">walk</span><span class="o">-</span><span class="n">frames</span><span class="o">.</span><span class="n">zip</span> \
    <span class="o">-</span><span class="n">O</span> <span class="n">zombie</span><span class="o">-</span><span class="n">walk</span><span class="o">-</span><span class="n">frames</span><span class="o">.</span><span class="n">zip</span>

<span class="c1"># unzip test images</span>
<span class="n">local_zip</span> <span class="o">=</span> <span class="s1">&#39;./zombie-walk-frames.zip&#39;</span>
<span class="n">zip_ref</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">local_zip</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;./results&#39;</span><span class="p">)</span>
<span class="n">zip_ref</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You will load these images into numpy arrays to prepare it for inference.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">test_image_dir</span> <span class="o">=</span> <span class="s1">&#39;./results/&#39;</span>
<span class="n">test_images_np</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># load images into a numpy array. this will take a few minutes to complete.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">237</span><span class="p">):</span>
    <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_image_dir</span><span class="p">,</span> <span class="s1">&#39;zombie-walk&#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{0:04}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
    <span class="n">test_images_np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
      <span class="n">load_image_into_numpy_array</span><span class="p">(</span><span class="n">image_path</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a name='exercise-11'></a></p>
<h3 id="exercise-11-preprocess-predict-and-post-process-an-image"><strong>Exercise 11</strong>: Preprocess, predict, and post process an image</h3>
<p>Define a function that returns the detection boxes, classes, and scores.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Again, uncomment this decorator if you want to run inference eagerly</span>
<span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">detect</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run detection on an input image.</span>

<span class="sd">    Args:</span>
<span class="sd">    input_tensor: A [1, height, width, 3] Tensor of type tf.float32.</span>
<span class="sd">      Note that height and width can be anything since the image will be</span>
<span class="sd">      immediately resized according to the needs of the model within this</span>
<span class="sd">      function.</span>

<span class="sd">    Returns:</span>
<span class="sd">    A dict containing 3 Tensors (`detection_boxes`, `detection_classes`,</span>
<span class="sd">      and `detection_scores`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preprocessed_image</span><span class="p">,</span> <span class="n">shapes</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
    <span class="n">prediction_dict</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">preprocessed_image</span><span class="p">,</span> <span class="n">shapes</span><span class="p">)</span>

    <span class="c1">### START CODE HERE (Replace instances of `None` with your code) ###</span>
    <span class="c1"># use the detection model&#39;s postprocess() method to get the the final detections</span>
    <span class="n">detections</span> <span class="o">=</span> <span class="n">detection_model</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">prediction_dict</span><span class="p">,</span> <span class="n">shapes</span><span class="p">)</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">detections</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can now loop through the test images and get the detection scores and bounding boxes to overlay in the original image. We will save each result in a <code>results</code> dictionary and the autograder will use this to evaluate your results.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># Note that the first frame will trigger tracing of the tf.function, which will</span>
<span class="c1"># take some time, after which inference should be fast.</span>

<span class="n">label_id_offset</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;boxes&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">[]}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_images_np</span><span class="p">)):</span>
    <span class="n">input_tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">test_images_np</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">detections</span> <span class="o">=</span> <span class="n">detect</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
    <span class="n">plot_detections</span><span class="p">(</span>
      <span class="n">test_images_np</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
      <span class="n">detections</span><span class="p">[</span><span class="s1">&#39;detection_boxes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
      <span class="n">detections</span><span class="p">[</span><span class="s1">&#39;detection_classes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
      <span class="o">+</span> <span class="n">label_id_offset</span><span class="p">,</span>
      <span class="n">detections</span><span class="p">[</span><span class="s1">&#39;detection_scores&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
      <span class="n">category_index</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">image_name</span><span class="o">=</span><span class="s2">&quot;./results/gif_frame_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%03d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;boxes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="s1">&#39;detection_boxes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detections</span><span class="p">[</span><span class="s1">&#39;detection_scores&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># TEST CODE</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;boxes&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;boxes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># compare with expected bounding boxes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;boxes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.28838485</span><span class="p">,</span> <span class="mf">0.06830047</span><span class="p">,</span> <span class="mf">0.7213766</span> <span class="p">,</span> <span class="mf">0.19833465</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.18</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;boxes&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.29168868</span><span class="p">,</span> <span class="mf">0.07529271</span><span class="p">,</span> <span class="mf">0.72504973</span><span class="p">,</span> <span class="mf">0.20099735</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.18</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;boxes&#39;</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.29548776</span><span class="p">,</span> <span class="mf">0.07994056</span><span class="p">,</span> <span class="mf">0.7238164</span> <span class="p">,</span> <span class="mf">0.20778716</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.18</span><span class="p">))</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Expected Output:</strong> Ideally the three boolean values at the bottom should be <code>True</code>. But if you only get two, you can still try submitting. This compares your resulting bounding boxes for each zombie image to some preloaded coordinates (i.e. the hardcoded values in the test cell above). Depending on how you annotated the training images,it's possible that some of your results differ for these three frames but still get good results overall when all images are examined by the grader. If two or all are False, please try annotating the images again with a tighter bounding box or use the <a href="#gt-boxes">predefined <code>gt_boxes</code> list</a>.</p>
<div class="highlight"><pre><span></span><code>237
(4,)

True
True
True
</code></pre></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also check if the model detects a zombie class in the images by examining the <code>scores</code> key of the <code>results</code> dictionary. You should get higher than 88.0 here.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>

<span class="c1"># percent of frames where a zombie is detected</span>
<span class="n">zombie_detected</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">/</span><span class="mi">237</span><span class="o">*</span><span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="n">zombie_detected</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also display some still frames and inspect visually. If you don't see a bounding box around the zombie, please consider re-annotating the ground truth or use the predefined <code>gt_boxes</code> <a href="#gt-boxes">here</a></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Frame 0&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">IPyImage</span><span class="p">(</span><span class="s1">&#39;./results/gif_frame_000.jpg&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Frame 5&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">IPyImage</span><span class="p">(</span><span class="s1">&#39;./results/gif_frame_005.jpg&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Frame 10&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">IPyImage</span><span class="p">(</span><span class="s1">&#39;./results/gif_frame_010.jpg&#39;</span><span class="p">))</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="create-a-zip-of-the-zombie-walk-images">Create a zip of the zombie-walk images.</h2>
<p>You can download this if you like to create your own animations</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">zipf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="s1">&#39;./zombie.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./results/gif_frame_*.jpg&#39;</span><span class="p">)</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">zipf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="create-zombie-animation">Create Zombie animation</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">imageio</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">freeimage</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>

<span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">./</span><span class="n">results</span><span class="o">/</span><span class="n">zombie</span><span class="o">-</span><span class="n">anim</span><span class="o">.</span><span class="n">gif</span>

<span class="n">anim_file</span> <span class="o">=</span> <span class="s1">&#39;./zombie-anim.gif&#39;</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./results/gif_frame_*.jpg&#39;</span><span class="p">)</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
<span class="n">last</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="n">imageio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="n">anim_file</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="s1">&#39;GIF-FI&#39;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unfortunately, using <code>IPyImage</code> in the notebook (as you've done in the rubber ducky detection tutorial) for the large <code>gif</code> generated will disconnect the runtime. To view the animation, you can instead use the <code>Files</code> pane on the left and double-click on <code>zombie-anim.gif</code>. That will open a preview page on the right. It will take 2 to 3 minutes to load and see the walking zombie.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="save-results-file-for-grading">Save results file for grading</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run the cell below to save your results. Download the <code>results.data</code> file and upload it to the grader in the classroom.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># remove file if it exists</span>
<span class="err">!</span><span class="n">rm</span> <span class="n">results</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># write results to binary file. upload for grading.</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;results.data&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filehandle</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;boxes&#39;</span><span class="p">],</span> <span class="n">filehandle</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done saving! Please download `results.data` from the Files tab</span><span class="se">\n</span><span class="s1">&#39;</span> \
      <span class="s1">&#39;on the left and submit for grading.</span><span class="se">\n</span><span class="s1">You can also use the next cell as a shortcut for downloading.&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>

<span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;results.data&#39;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Congratulations on completing this assignment! Please go back to the Coursera classroom and upload <code>results.data</code> to the Graded Lab item for Week 2.</strong></p>
</div>
</div>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/hari31416" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/hari31416" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/hari31416" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.kaggle.com/hari31416" target="_blank" rel="noopener" title="www.kaggle.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M304.2 501.5 158.4 320.3 298.2 185c2.6-2.7 1.7-10.5-5.3-10.5h-69.2c-3.5 0-7 1.8-10.5 5.3L80.9 313.5V7.5q0-7.5-7.5-7.5H21.5Q14 0 14 7.5v497q0 7.5 7.5 7.5h51.9q7.5 0 7.5-7.5v-109l30.8-29.3 110.5 140.6c3 3.5 6.5 5.3 10.5 5.3h66.9q5.25 0 6-3z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.instagram.com/hari31416" target="_blank" rel="noopener" title="www.instagram.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.top", "toc.integrate"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>